<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepo Super App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Updated Font Awesome to include a wider range of icons, though specific flags may not be in the free tier -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb; /* Blue 600 */
            --secondary-color: #f59e0b; /* Amber 500 */
            --background-color: #f8fafc; /* Slate 50 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
        }

        .header-gradient {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e40af 100%);
        }

        .service-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .service-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Custom scrollbar for mobile feel */
        .scrollable-content::-webkit-scrollbar {
            width: 4px;
        }

        .scrollable-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }

        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .modal-content {
            transition: transform 0.3s ease;
        }

        .modal.hidden .modal-content {
            transform: scale(0.9);
        }

        /* --- New Construction Effect CSS --- */
        @keyframes stripes-move {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }

        .construction-effect {
            /* Yellow/Orange striped background */
            background-image: repeating-linear-gradient(
                45deg,
                #fcd34d 0, /* Amber 300 */
                #fcd34d 10px,
                #fcd34d 10px, /* Amber 300 */
                #f59e0b 20px /* Amber 500 */
            );
            background-size: 40px 40px;
            animation: stripes-move 0.7s linear infinite;
            border-color: #f59e0b;
            color: #78350f; /* Dark brown text for contrast */
        }
        /* --- End Construction Effect CSS */
    </style>
</head>
<body class="min-h-screen antialiased">

    <script type="module">
        // IMPORTANT: These imports are required for Firebase/Firestore functionality
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, serverTimestamp, setLogLevel, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- FIREBASE CONFIGURATION FIX ---
        // Global variables for Canvas environment. Must be declared for demo/real mode.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY_HERE", 
            authDomain: "nepo-super-app-demo.firebaseapp.com",
            projectId: "nepo-super-app-demo",
            storageBucket: "nepo-super-app-demo.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abcdefg12345"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId; 
        
        let db, auth;
        let userId = 'demo-user-' + Math.random().toString(36).substring(2, 10);
        let isAuthReady = false;
        let isFirebaseActive = false;
        // --- END FIREBASE CONFIGURATION FIX ---

        // Set log level for debugging
        setLogLevel('Debug');

        // --- Service Definitions ---
        const serviceMap = {
            news: { name: 'Nepo News', icon: 'fa-newspaper', color: 'bg-red-600' },
            calendar: { name: 'Nepo Calendar', icon: 'fa-calendar-days', color: 'bg-orange-600' },
            driving: { name: 'Nepo Driving', icon: 'fa-car-side', color: 'bg-indigo-600' },
            care: { name: 'Nepo Care', icon: 'fa-hand-holding-medical', color: 'bg-teal-600' },
            secondhand: { name: 'Nepo Second-Hand Market', icon: 'fa-tags', color: 'bg-green-600' },
            shopping: { name: 'Nepo Online Shopping', icon: 'fa-bag-shopping', color: 'bg-purple-600' },
            visa: { name: 'Nepo Visa Check', icon: 'fa-passport', color: 'bg-blue-600' },
            donation: { name: 'Nepo Donation', icon: 'fa-hand-holding-heart', color: 'bg-pink-600' },
            roomrent: { name: 'Nepo Room Rent', icon: 'fa-house-chimney', color: 'bg-yellow-600' },
            jobs: { name: 'Nepo Part-Time Job', icon: 'fa-briefcase', color: 'bg-gray-600' },
        };

        const newsSources = [
            'https://www.onlinekhabar.com/', 
            'https://myrepublica.nagariknetwork.com/', 
            'https://kathmandupost.com/', 
            'https://nepalitimes.com/', 
            'https://www.thehimalayantimes.com/', 
            'https://annapurnapost.com/', 
            'https://ekantipur.com/', 
            'https://www.setopati.com/', 
            'https://www.ratopati.com/', 
            'https://www.himalkhabar.com/'
        ];
        
        // Function to get a random news source URL
        const getRandomSourceUrl = () => newsSources[Math.floor(Math.random() * newsSources.length)];

        // --- Mock Data ---
        const forecastMessages = [
            { icon: 'fa-cloud-showers-heavy', message: 'Heavy Rain Alert: Use your umbrella!', color: 'text-blue-300' },
            { icon: 'fa-sun', message: 'Hot & Sunny: Stay hydrated today!', color: 'text-yellow-300' },
            { icon: 'fa-smog', message: 'Air Quality Alert: Minimize outdoor activities.', color: 'text-gray-400' },
            { icon: 'fa-cloud', message: 'Partly cloudy, pleasant weather for travel.', color: 'text-gray-200' },
            { icon: 'fa-cloud-rain', message: 'Light Drizzle: Carry light rain gear.', color: 'text-blue-300' },
            { icon: 'fa-mountain', message: 'Clear Mountain Views: Great trekking weather.', color: 'text-green-300' },
            { icon: 'fa-temperature-low', message: 'Cold Morning: Wear warm layers if heading out early.', color: 'text-cyan-300' }
        ];

        const sevenDayForecast = [
            { day: "Today", condition: "Light Drizzle", temp: "18° / 12° C", wind: "10 km/h", icon: "fa-cloud-rain" },
            { day: "Wed", condition: "Heavy Rain", temp: "15° / 10° C", wind: "15 km/h", icon: "fa-cloud-showers-heavy" },
            { day: "Thu", condition: "Partly Sunny", temp: "21° / 13° C", wind: "8 km/h", icon: "fa-cloud-sun" },
            { day: "Fri", condition: "Clear", temp: "23° / 14° C", wind: "5 km/h", icon: "fa-sun" },
            { day: "Sat", condition: "Smog", temp: "19° / 11° C", wind: "3 km/h", icon: "fa-smog" },
            { day: "Sun", condition: "Cloudy", temp: "17° / 10° C", wind: "12 km/h", icon: "fa-cloud" },
            { day: "Mon", condition: "Light Wind", temp: "20° / 12° C", wind: "7 km/h", icon: "fa-wind" }
        ];

        // --- UPDATED: 10 Driving Examples ---
        const nepoDrivingPastExamples = [
            { pickup: "Thamel", dropoff: "Tribhuvan Airport", status: "Completed", type: "Car", cost: 850 },
            { pickup: "Lalitpur", dropoff: "Boudhanath Stupa", status: "Completed", type: "Bike", cost: 250 },
            { pickup: "Baneshwor", dropoff: "Patan Durbar Square", status: "Completed", type: "Carpool", cost: 320 },
            { pickup: "Gongabu", dropoff: "New Road", status: "Completed", type: "Car", cost: 480 },
            { pickup: "Teku", dropoff: "Kirtipur Hill", status: "Completed", type: "Premium", cost: 1100 },
            // Added 5 more
            { pickup: "Pokhara Lakeside", dropoff: "Pokhara Airport", status: "Completed", type: "Car", cost: 950 },
            { pickup: "Dharan Buspark", dropoff: "Bhedetar", status: "Completed", type: "Bike", cost: 300 },
            { pickup: "Buddhanagar", dropoff: "Maitidevi", status: "Completed", type: "Carpool", cost: 210 },
            { pickup: "Jhamsikhel", dropoff: "Balaju", status: "Completed", type: "Premium", cost: 1300 },
            { pickup: "Bhaktapur", dropoff: "Sanga Hill", status: "Completed", type: "Car", cost: 720 }
        ];

        // --- UPDATED: 10 News Examples ---
        const nepoNewsExamples_full = [
            { title: "Nepal's Ride-Hailing Industry Set to Reach $74 Million Revenue in 2025", source: "Gurkha Technology", time: "1 hr ago", category: "Technology", color: "bg-blue-500", url: getRandomSourceUrl() },
            { title: "Pakhribas Emerging as a Popular New Tourist Destination with View Tower", source: "The Rising Nepal", time: "3 hrs ago", category: "Tourism", color: "bg-green-500", url: getRandomSourceUrl() },
            { title: "International Arrivals Recover to 98% of Pre-Pandemic Levels in 2025", source: "Travel & Tour World", time: "5 hrs ago", category: "Tourism", color: "bg-orange-500", url: getRandomSourceUrl() },
            { title: "NEPSE Posts Double-Digit Gain; All Sectors Close in Green", source: "The Himalayan Times", time: "Yesterday", category: "Business", color: "bg-red-500", url: getRandomSourceUrl() },
            { title: "FDI Commitment Soars, Led by Information and Communication Technology", source: "Xinhua", time: "1 day ago", category: "Economy", color: "bg-purple-500", url: getRandomSourceUrl() },
            // Added 5 more original examples
            { title: "Kathmandu Valley Air Quality Improves Slightly After Monsoon Rainfall", source: "Online Khabar", time: "2 days ago", category: "Environment", color: "bg-blue-600", url: getRandomSourceUrl() },
            { title: "New Foreign Investment Policy Aims to Boost Technology Sector", source: "MyRepublica", time: "3 days ago", category: "Business", color: "bg-green-700", url: getRandomSourceUrl() },
            { title: "Historic Bhaktapur Durbar Square Restoration Enters Final Phase", source: "The Kathmandu Post", time: "4 days ago", category: "Culture", color: "bg-orange-700", url: getRandomSourceUrl() },
            { title: "Local Football Team Wins Regional Championship, Fans Celebrate", source: "Nepali Times", time: "5 days ago", category: "Sports", color: "bg-red-700", url: getRandomSourceUrl() },
            { title: "Government Launches Digital Literacy Campaign in Rural Provinces", source: "The Himalayan Times", time: "6 days ago", category: "Technology", color: "bg-purple-700", url: getRandomSourceUrl() }
        ];

        // --- UPDATED: 10 Calendar Examples ---
        const nepoCalendarExamples_full = [
            { name: "Dashain (Mahanavami)", date: "Aswin 24, 2082 B.S.", type: "National Festival", color: "bg-red-600", icon: "fa-champagne-glasses" },
            { name: "Tihar (Laxmi Puja)", date: "Kartik 10, 2082 B.S.", type: "National Festival", color: "bg-orange-600", icon: "fa-lightbulb" },
            { name: "Lhosar", date: "Magh 25, 2082 B.S.", type: "Community Event", color: "bg-blue-600", icon: "fa-dragon" },
            { name: "My Friend's Birthday", date: "Bhadra 5, 2082 B.S.", type: "Personal Reminder", color: "bg-purple-600", icon: "fa-cake-candles" },
            { name: "Full Moon (Purnima)", date: "Upcoming: Jestha 1, 2083 B.S.", type: "Lunar Cycle", color: "bg-teal-600", icon: "fa-moon" },
            // Added 5 more
            { name: "Republic Day", date: "Jestha 15, 2083 B.S.", type: "National Holiday", color: "bg-green-600", icon: "fa-flag" },
            { name: "Teej Festival", date: "Bhadra 1, 2082 B.S.", type: "National Festival", color: "bg-pink-600", icon: "fa-person-dress" },
            { name: "Nepal Sambat New Year", date: "Kartik 11, 2082 B.S.", type: "Cultural Event", color: "bg-red-700", icon: "fa-gopuram" },
            { name: "New Year's Day (B.S.)", date: "Baisakh 1, 2083 B.S.", type: "National Holiday", color: "bg-orange-700", icon: "fa-globe-asia" },
            { name: "Scheduled Medical Checkup", date: "Poush 10, 2082 B.S.", type: "Personal Reminder", color: "bg-cyan-600", icon: "fa-user-nurse" }
        ];

        // --- 20 Common Disease Data (English & Nepali) - Unchanged for brevity ---
        const nepoDiseaseData = {
            // 1. Common Cold
            'cold': {
                icon: 'fa-head-side-cough', color: 'text-blue-500', name_en: 'Common Cold', name_ne: 'सामान्य रुघा',
                en: {
                    intro: 'A viral infection of the nose and throat, characterized by sneezing, congestion, and sore throat.',
                    causes: 'Caused by hundreds of different viruses, primarily rhinoviruses, spread through air or direct contact.',
                    aware: 'Maintain good hygiene, wash hands frequently, and avoid close contact with infected individuals. Cover your mouth and nose when coughing or sneezing.'
                },
                ne: {
                    intro: 'नाक र घाँटीको भाइरल संक्रमण हो, जसको विशेषता हाच्छिउँ आउनु, नाक बन्द हुनु र घाँटी दुख्नु हो।',
                    causes: 'मुख्यतया राइनोभाइरस लगायत सयौं विभिन्न भाइरसका कारणले हुन्छ, जुन हावा वा प्रत्यक्ष सम्पर्कबाट फैलिन्छ।',
                    aware: 'सफा रहनुहोस्, बारम्बार हात धुनुहोस्, र संक्रमित व्यक्तिहरूसँगको नजिकको सम्पर्कबाट जोगिनुहोस्। खोक्दा वा हाच्छिउँ गर्दा मुख र नाक छोप्नुहोस्।'
                }
            },
            // 2. Influenza (Flu)
            'flu': {
                icon: 'fa-virus', color: 'text-red-500', name_en: 'Influenza (Flu)', name_ne: 'इन्फ्लुएन्जा (फ्लू)',
                en: {
                    intro: 'A contagious respiratory illness, more severe than a cold, causing fever, body aches, and fatigue.',
                    causes: 'Caused by influenza viruses. It spreads mainly by droplets when infected people cough, sneeze or talk.',
                    aware: 'Get an annual flu shot. Avoid touching your eyes, nose, and mouth. Stay home when sick to prevent spreading the virus.'
                },
                ne: {
                    intro: 'रूघा भन्दा कडा श्वासप्रश्वासको संक्रामक रोग हो, जसले ज्वरो, शरीर दुख्ने र थकान महसुस गराउँछ।',
                    causes: 'इन्फ्लुएन्जा भाइरसले गर्दा हुन्छ। यो मुख्यतया संक्रमित व्यक्तिले खोक्दा, हाच्छिउँ गर्दा वा कुरा गर्दा निस्कने थोपाहरूबाट फैलिन्छ।',
                    aware: 'हरेक वर्ष फ्लूको खोप लगाउनुहोस्। आँखा, नाक र मुख छुनबाट जोगिनुहोस्। भाइरस फैलिनबाट रोक्न बिरामी हुँदा घरमै बस्नुहोस्।'
                }
            },
            // 3. Dengue Fever
            'dengue': {
                icon: 'fa-mosquito', color: 'text-orange-500', name_en: 'Dengue Fever', name_ne: 'डेङ्गु ज्वरो',
                en: {
                    intro: 'A painful, debilitating mosquito-borne disease common in tropical and subtropical regions.',
                    causes: 'Caused by the dengue virus, transmitted through the bite of Aedes mosquitoes, especially during monsoon.',
                    aware: 'Eliminate standing water sources around your home. Use mosquito nets and repellents. Wear long sleeves and pants during peak biting hours.'
                },
                ne: {
                    intro: 'उष्णकटिबंधीय क्षेत्रहरूमा सामान्य लामखुट्टेबाट सर्ने पीडादायक र कमजोर बनाउने रोग हो।',
                    causes: 'डेङ्गु भाइरसका कारणले हुन्छ, जुन एडिस लामखुट्टेको टोकाइबाट सर्छ, विशेषगरी मनसुनमा।',
                    aware: 'आफ्नो घर वरपर जमेको पानी हटाउनुहोस्। लामखुट्टेको जाली र भगाउने औषधि प्रयोग गर्नुहोस्। लामखुट्टेले बढी टोक्ने समयमा लामो बाहुला र पाइन्ट लगाउनुहोस्।'
                }
            },
            // 4. Typhoid Fever
            'typhoid': {
                icon: 'fa-bowl-food', color: 'text-yellow-600', name_en: 'Typhoid Fever', name_ne: 'टाइफाइड ज्वरो',
                en: {
                    intro: 'A bacterial infection that can spread throughout the body, affecting many organs. High fever is a primary symptom.',
                    causes: 'Caused by Salmonella Typhi bacteria, spread through contaminated food or water.',
                    aware: 'Ensure food is thoroughly cooked and served hot. Drink only boiled, purified, or bottled water. Get vaccinated if traveling to endemic areas.'
                },
                ne: {
                    intro: 'यो एक ब्याक्टेरियल संक्रमण हो जुन शरीरभरि फैलिएर धेरै अंगहरूलाई असर गर्न सक्छ। उच्च ज्वरो यसको मुख्य लक्षण हो।',
                    causes: 'साल्मोनेला टाइफी ब्याक्टेरियाको कारणले हुन्छ, जुन दूषित खाना वा पानीबाट फैलिन्छ।',
                    aware: 'खाना राम्ररी पकाएको र तातो सेवा गरिएको सुनिश्चित गर्नुहोस्। उमालेको, शुद्ध वा बोतलको मात्र पानी पिउनुहोस्। महामारी भएको क्षेत्रमा यात्रा गर्दा खोप लगाउनुहोस्।'
                }
            },
            // 5. Diabetes Mellitus (Type 2)
            'diabetes': {
                icon: 'fa-sugar-cube', color: 'text-pink-600', name_en: 'Diabetes (Type 2)', name_ne: 'मधुमेह (टाइप २)',
                en: {
                    intro: 'A chronic condition where the body does not effectively use insulin or cannot produce enough, leading to high blood sugar levels.',
                    causes: 'A combination of genetic factors, obesity, poor diet, and lack of physical activity.',
                    aware: 'Maintain a healthy body weight and consume a balanced diet low in processed sugars. Engage in regular physical activity (at least 30 minutes daily).'
                },
                ne: {
                    intro: 'एक दीर्घकालीन अवस्था हो जहाँ शरीरले इन्सुलिनलाई प्रभावकारी रूपमा प्रयोग गर्दैन वा पर्याप्त उत्पादन गर्न सक्दैन, जसले रगतमा चिनीको मात्रा बढाउँछ।',
                    causes: 'आनुवंशिक कारक, मोटोपना, खराब आहार र शारीरिक गतिविधिको कमीको संयोजन हो।',
                    aware: 'स्वस्थ शरीरको तौल कायम राख्नुहोस् र प्रशोधित चिनी कम भएको सन्तुलित आहार सेवन गर्नुहोस्। नियमित शारीरिक गतिविधिमा संलग्न हुनुहोस् (दैनिक कम्तिमा ३० मिनेट)।'
                }
            },
            // 6. Hypertension (High Blood Pressure)
            'hyper': {
                icon: 'fa-heart-pulse', color: 'text-indigo-600', name_en: 'Hypertension (High BP)', name_ne: 'उच्च रक्तचाप',
                en: {
                    intro: 'A condition in which the force of the blood against the artery walls is too high, leading to heart disease and stroke risks.',
                    causes: 'Often develops over time due to unhealthy lifestyle choices, such as high salt intake, lack of exercise, and smoking.',
                    aware: 'Reduce salt and caffeine intake. Limit alcohol consumption and quit smoking. Exercise regularly and manage stress through meditation or yoga.'
                },
                ne: {
                    intro: 'धमनीका भित्ताहरू विरुद्ध रगतको बल धेरै उच्च हुने अवस्था हो, जसले हृदय रोग और स्ट्रोकको जोखिम बढाउँछ।',
                    causes: 'प्रायः उच्च नुन सेवन, व्यायामको कमी र धूम्रपान जस्ता अस्वस्थ जीवनशैलीका कारण समयसँगै विकसित हुन्छ।',
                    aware: 'नुन र क्याफिन सेवन कम गर्नुहोस्। मदिरा सेवन सीमित गर्नुहोस् र धूम्रपान छोड्नुहोस्। नियमित व्यायाम गर्नुहोस् और ध्यान वा योग मार्फत तनाव व्यवस्थापन गर्नुहोस्।'
                }
            },
            // 7. Tuberculosis (TB)
            'tb': {
                icon: 'fa-lungs', color: 'text-brown-500', name_en: 'Tuberculosis (TB)', name_ne: 'क्षयरोग (टीबी)',
                en: {
                    intro: 'A potentially serious infectious disease that mainly affects the lungs. It is spread through the air when an infected person coughs or sneezes.',
                    causes: 'Caused by the bacterium Mycobacterium tuberculosis.',
                    aware: 'Ensure proper ventilation in living spaces. If diagnosed, complete the full course of medication without interruption. Get infants vaccinated with the BCG vaccine.'
                },
                ne: {
                    intro: 'यो एक सम्भावित गम्भीर संक्रामक रोग हो जसले मुख्यतया फोक्सोलाई असर गर्छ। यो संक्रमित व्यक्तिले खोक्दा वा हाच्छिउँ गर्दा हावा मार्फत फैलिन्छ।',
                    causes: 'माइकोब्याक्टेरियम ट्युबरकुलोसिस नामक ब्याक्टेरियाबाट हुन्छ।',
                    aware: 'बस्ने ठाउँहरूमा उचित भेन्टिलेसन सुनिश्चित गर्नुहोस्। यदि निदान गरिएमा, औषधिको पूर्ण कोर्स बिना अवरोध पूरा गर्नुहोस्। शिशुहरूलाई बीसीजी खोप लगाउनुहोस्।'
                }
            },
            // 8. Gastritis/Indigestion
            'gastritis': {
                icon: 'fa-stomach', color: 'text-green-600', name_en: 'Gastritis/Indigestion', name_ne: 'ग्यास्ट्राइटिस/अपच',
                en: {
                    intro: 'Inflammation of the stomach lining, often causing stomach pain, bloating, and nausea.',
                    causes: 'Caused by regular use of pain relievers, excessive alcohol, or Helicobacter pylori (H. pylori) infection.',
                    aware: 'Avoid spicy, oily, and highly acidic foods. Eat smaller, frequent meals. Manage stress and limit the use of non-steroidal anti-inflammatory drugs (NSAIDs).'
                },
                ne: {
                    intro: 'पेटको अस्तरको सूजन हो, जसले प्रायः पेट दुख्ने, पेट फुल्ने र वाकवाकी लाग्ने गर्छ।',
                    causes: 'दुखाइ कम गर्ने औषधिहरूको नियमित प्रयोग, अत्यधिक मदिरा वा हेलिकोब्याक्टर पाइलोरी (H. pylori) संक्रमणका कारणले हुन्छ।',
                    aware: 'पिरो, चिल्लो र धेरै अमिलो खानेकुराबाट जोगिनुहोस्। थोरै-थोरै र बारम्बार खानुहोस्। तनाव व्यवस्थापन गर्नुहोस् र एनएसएआईडीएस (NSAIDs) को प्रयोग सीमित गर्नुहोस्।'
                }
            },
            // 9. Chronic Obstructive Pulmonary Disease (COPD)
            'copd': {
                icon: 'fa-smoking-ban', color: 'text-gray-800', name_en: 'COPD', name_ne: 'फोक्सोको दीर्घकालीन रोग',
                en: {
                    intro: 'A group of lung diseases that block airflow and make it difficult to breathe, including emphysema and chronic bronchitis.',
                    causes: 'Long-term exposure to irritating gases or particulate matter, most often from cigarette smoke or indoor pollution (e.g., biomass fuel smoke).',
                    aware: 'Crucially, quit smoking immediately. Minimize exposure to dust, fumes, and smoke, including indoor cooking smoke. Use prescribed inhalers correctly.'
                },
                ne: {
                    intro: 'फोक्सोको रोगहरूको समूह हो जसले वायु प्रवाहलाई रोक्छ र सास फेर्न गाह्रो बनाउँछ, जसमा वातस्फीति र दीर्घकालीन ब्रोंकाइटिस समावेश छन्।',
                    causes: 'लामो समयसम्म चिढाउने ग्यास वा कण पदार्थको सम्पर्कमा रहनु, प्राय: चुरोटको धुवाँ वा घरभित्रको प्रदूषण (जस्तै: दाउराको धुवाँ) बाट।',
                    aware: 'तत्काल धूम्रपान छोड्नुहोस्। धुलो, धुवाँ, र भित्री खाना पकाउने धुवाँ सहितको सम्पर्कलाई कम गर्नुहोस्। निर्धारित इन्हेलरहरू सही तरिकाले प्रयोग गर्नुहोस्।'
                }
            },
            // 10. Kidney Stones
            'kidney': {
                icon: 'fa-urology', color: 'text-cyan-600', name_en: 'Kidney Stones', name_ne: 'मिर्गौलाको पत्थरी',
                en: {
                    intro: 'Hard deposits of minerals and salts that form inside the kidneys, often causing severe pain when passing through the urinary tract.',
                    causes: 'Concentrated urine, often caused by dehydration, diet, and certain medical conditions.',
                    aware: 'Drink plenty of water throughout the day (2-3 liters). Reduce sodium, sugar, and animal protein intake. Consult a doctor for dietary recommendations.'
                },
                ne: {
                    intro: 'मिर्गौला भित्र बन्ने खनिज र नुनको कडा निक्षेप हो, जुन पिसाब नलीबाट जाँदा प्रायः तीव्र पीडा निम्त्याउँछ।',
                    causes: 'प्रायः निर्जलीकरण, आहार र केही स्वास्थ्य अवस्थाहरूका कारण पिसाब गाढा हुनु।',
                    aware: 'दिनभरि प्रशस्त पानी पिउनुहोस् (२-३ लिटर)। सोडियम, चिनी र जनावरको प्रोटिन सेवन कम गर्नुहोस्। आहारसम्बन्धी सिफारिसहरूको लागि डाक्टरसँग सल्लाह लिनुहोस्।'
                }
            },
            // 11. Asthma
            'asthma': {
                icon: 'fa-person-running', color: 'text-purple-500', name_en: 'Asthma', name_ne: 'दम रोग',
                en: {
                    intro: 'A chronic disease involving airway inflammation and narrowing, leading to difficulty breathing, wheezing, and coughing.',
                    causes: 'Triggers include air pollution, allergens (pollen, dust mites), respiratory infections, and exercise.',
                    aware: 'Identify and avoid personal triggers. Always carry and correctly use prescribed inhalers. Monitor peak flow regularly.'
                },
                ne: {
                    intro: 'श्वासमार्गको सूजन र साँघुरोपना समावेश भएको एक दीर्घकालीन रोग हो, जसले सास फेर्न कठिनाई, सुस्केरा र खोकी निम्त्याउँछ।',
                    causes: 'प्रदूषण, एलर्जी (परागकण, धूलो), श्वासप्रश्वास संक्रमण, र व्यायामले यसलाई उत्प्रेरित गर्दछ।',
                    aware: 'व्यक्तिगत ट्रिगरहरू पहिचान गर्नुहोस् र तिनीहरूबाट जोगिनुहोस्। निर्धारित इन्हेलरहरू सधैं बोक्नुहोस् र सही रूपमा प्रयोग गर्नुहोस्। नियमित रूपमा पीक फ्लो निगरानी गर्नुहोस्।'
            }
            },
            // 12. Diarrhea
            'diarrhea': {
                icon: 'fa-toilet', color: 'text-brown-500', name_en: 'Diarrhea', name_ne: 'पखाला',
                en: {
                    intro: 'Frequent passage of loose or watery stools, leading to dehydration if not managed quickly.',
                    causes: 'Bacterial or viral infections, parasites, or certain medications. Commonly due to consuming contaminated water/food.',
                    aware: 'Maintain strict hand hygiene, especially before eating and after using the toilet. Drink ORS (Oral Rehydration Solution) immediately. Ensure water is safe.'
                },
                ne: {
                    intro: 'पातलो वा पानी जस्तो दिसा बारम्बार हुनु, जसलाई तुरुन्तै व्यवस्थापन नगरे निर्जलीकरण हुन सक्छ।',
                    causes: 'ब्याक्टेरिया वा भाइरल संक्रमण, परजीवी वा केही औषधिहरू। सामान्यतया दूषित पानी/खाना उपभोग गर्दा।',
                    aware: 'शौचालय प्रयोग गरेपछि र खाना खानु अघि हातको सरसफाइमा कडाइ गर्नुहोस्। तुरुन्तै ओआरएस (जीवनजल) पिउनुहोस्। पानी सुरक्षित भएको सुनिश्चित गर्नुहोस्।'
                }
            },
            // 13. Jaundice (Hepatitis)
            'jaundice': {
                icon: 'fa-tint', color: 'text-amber-500', name_en: 'Jaundice (Hepatitis)', name_ne: 'जन्डिस (कलेजोको रोग)',
                en: {
                    intro: 'A yellow discoloration of the skin and eyes caused by excess bilirubin in the blood. It often indicates a liver problem.',
                    causes: 'Viral infections (Hepatitis A, B, C), gallstones, or excessive alcohol use.',
                    aware: 'Get vaccinated against Hepatitis A and B. Maintain clean sanitation and hygiene. Avoid uncooked or contaminated food and water.'
                },
                ne: {
                    intro: 'रगतमा बिलिरुबिनको अधिकताका कारण छाला र आँखा पहेँलो हुने अवस्था। यसले प्रायः कलेजोको समस्यालाई संकेत गर्दछ।',
                    causes: 'भाइरल संक्रमण (हेपाटाइटिस ए, बी, सी), पित्तथैलीको पत्थरी, वा अत्यधिक मदिरा सेवन।',
                    aware: 'हेपाटाइटिस ए र बी विरुद्ध खोप लगाउनुहोस्। सफा सरसफाइ र स्वच्छता कायम राख्नुहोस्। नपाकेको वा दूषित खाना र पानीबाट जोगिनुहोस्।'
                }
            },
            // 14. Anemia
            'anemia': {
                icon: 'fa-droplet', color: 'text-red-700', name_en: 'Anemia', name_ne: 'रक्तअल्पता',
                en: {
                    intro: 'A condition where the body lacks enough healthy red blood cells to carry adequate oxygen to body tissues, causing fatigue and weakness.',
                    causes: 'Iron deficiency, Vitamin B12 deficiency, or chronic diseases.',
                    aware: 'Consume iron-rich foods (red meat, spinach, beans) and Vitamin C (citrus fruits) to aid iron absorption. Take prescribed iron supplements if necessary.'
                },
                ne: {
                    intro: 'शरीरमा पर्याप्त अक्सिजन पुर्याउनको लागि पर्याप्त स्वस्थ रातो रक्त कोशिकाको कमी हुने अवस्था, जसले थकान र कमजोरी निम्त्याउँछ।',
                    causes: 'आइरनको कमी, भिटामिन बी१२ को कमी, वा दीर्घकालीन रोगहरू।',
                    aware: 'आइरन युक्त खानेकुरा (रातो मासु, पालक, सिमी) र आइरन अवशोषणमा सहयोग गर्न भिटामिन सी (सिट्रस फलफूल) सेवन गर्नुहोस्। आवश्यक भएमा निर्धारित आइरन सप्लिमेन्टहरू लिनुहोस्।'
            }
            },
            // 15. Arthritis
            'arthritis': {
                icon: 'fa-joint', color: 'text-teal-700', name_en: 'Arthritis', name_ne: 'जोर्नीको दुखाइ',
                en: {
                    intro: 'Inflammation or degeneration of one or more joints, causing pain, stiffness, and reduced mobility.',
                    causes: 'Wear-and-tear (osteoarthritis), autoimmune disorders (rheumatoid arthritis), and infections.',
                    aware: 'Maintain a healthy weight to reduce joint stress. Engage in low-impact exercises (swimming, walking). Use heat or cold therapy for pain relief.'
                },
                ne: {
                    intro: 'एक वा बढी जोर्नीहरूको सूजन वा क्षय, जसले दुखाइ, कडापन, र गतिशीलतामा कमी ल्याउँछ।',
                    causes: 'जोर्नी खिइनु (ओस्टियोआर्थराइटिस), अटोइम्यून विकार (रूमेटोइड आर्थराइटिस), र संक्रमणहरू।',
                    aware: 'जोर्नीको तनाव कम गर्न स्वस्थ तौल कायम राख्नुहोस्। कम प्रभाव पार्ने व्यायामहरू (पौडी खेल्ने, हिड्ने) मा संलग्न हुनुहोस्। दुखाइ कम गर्न तातो वा चिसो थेरापी प्रयोग गर्नुहोस्।'
                }
            },
            // 16. Malaria
            'malaria': {
                icon: 'fa-bed-alt', color: 'text-lime-500', name_en: 'Malaria', name_ne: 'औलो',
                en: {
                    intro: 'A mosquito-borne infectious disease characterized by fever, chills, and flu-like illness.',
                    causes: 'Caused by Plasmodium parasites, transmitted through the bite of infected female Anopheles mosquitoes.',
                    aware: 'Use insecticide-treated bed nets. Take antimalarial prophylactic drugs if traveling to high-risk areas. Eliminate mosquito breeding sites.'
                },
                ne: {
                    intro: 'ज्वरो, चिसो लाग्ने र फ्लू जस्तो बिमारी हुने लामखुट्टेबाट सर्ने संक्रामक रोग।',
                    causes: 'संक्रमित पोथी एनोफिलिस लामखुट्टेको टोकाइबाट सर्ने प्लाज्मोडियम परजीवीका कारणले हुन्छ।',
                    aware: 'कीटनाशकले उपचार गरिएको ओछ्यानको जाली प्रयोग गर्नुहोस्। उच्च जोखिम क्षेत्रमा यात्रा गर्दा औलो विरोधी रोकथाम औषधि लिनुहोस्। लामखुट्टेको प्रजनन स्थलहरू हटाउनुहोस्।'
                }
            },
            // 17. Urinary Tract Infection (UTI)
            'uti': {
                icon: 'fa-urinal', color: 'text-purple-700', name_en: 'UTI', name_ne: 'मूत्र संक्रमण',
                en: {
                    intro: 'An infection in any part of the urinary system (kidneys, ureters, bladder, and urethra), often causing burning during urination.',
                    causes: 'Bacteria entering the urinary tract, commonly E. coli.',
                    aware: 'Drink plenty of water. Wipe from front to back after using the toilet. Urinate when you feel the need and after intercourse.'
                },
                ne: {
                    intro: 'मूत्र प्रणाली (मिर्गौला, मूत्रवाहिनी, मूत्राशय, र मूत्रमार्ग) को कुनै पनि भागमा हुने संक्रमण, जसले प्रायः पिसाब गर्दा जलन निम्त्याउँछ।',
                    causes: 'मूत्र नलीमा प्रवेश गर्ने ब्याक्टेरिया, सामान्यतया ई. कोलाई।',
                    aware: 'प्रशस्त पानी पिउनुहोस्। शौचालय प्रयोग गरेपछि अगाडिबाट पछाडि पुछ्नुहोस्। पिसाब लाग्दा र यौन सम्पर्कपछि पिसाब गर्नुहोस्।'
                }
            },
            // 18. Lower Back Pain
            'backpain': {
                icon: 'fa-person-walking-with-cane', color: 'text-amber-700', name_en: 'Lower Back Pain', name_ne: 'कम्मर दुखाइ',
                en: {
                    intro: 'A very common condition involving pain or discomfort in the lower back area, often acute or chronic.',
                    causes: 'Poor posture, heavy lifting, sedentary lifestyle, muscle strains, or disc problems.',
                    aware: 'Practice correct lifting techniques (lift with legs, not back). Maintain good posture while sitting and standing. Engage in core strengthening exercises.'
                },
                ne: {
                    intro: 'कम्मरको तल्लो भागमा हुने दुखाइ वा असुविधा, जुन प्रायः तीव्र वा दीर्घकालीन हुन्छ।',
                    causes: 'गलत आसन, भारी सामान उठाउनु, निष्क्रिय जीवनशैली, मांसपेशी तानिनु, वा डिस्क समस्याहरू।',
                    aware: 'उचित तरिकाले उठाउने अभ्यास गर्नुहोस् (कम्मरले होइन, खुट्टाले उठाउनुहोस्)। बस्दा र उभिँदा राम्रो आसन कायम राख्नुहोस्। कोर बलियो बनाउने व्यायामहरूमा संलग्न हुनुहोस्।'
                }
            },
            // 19. Depression/Anxiety
            'mental': {
                icon: 'fa-brain', color: 'text-fuchsia-600', name_en: 'Depression/Anxiety', name_ne: 'डिप्रेसन/चिन्ता',
                en: {
                    intro: 'Common mental health disorders causing persistent sadness, lack of interest, excessive worry, and physical symptoms.',
                    causes: 'A complex interplay of genetic, biological, environmental, and psychological factors, including chronic stress and trauma.',
                    aware: 'Prioritize sleep and nutrition. Practice mindfulness and relaxation techniques. Seek professional help (counseling/therapy) if symptoms persist. Do not ignore mental health.'
                },
                ne: {
                    intro: 'सामान्य मानसिक स्वास्थ्य विकारहरू जसले निरन्तर उदासी, रुचि नहुनु, अत्यधिक चिन्ता, र शारीरिक लक्षणहरू निम्त्याउँछ।',
                    causes: 'आनुवंशिक, जैविक, वातावरणीय, र मनोवैज्ञानिक कारकहरूको जटिल अन्तरक्रिया, जसमा दीर्घकालीन तनाव र आघात समावेश छन्।',
                    aware: 'सुत्ने र पोषणमा प्राथमिकता दिनुहोस्। माइन्डफुलनेस र विश्राम प्रविधिहरूको अभ्यास गर्नुहोस्। यदि लक्षणहरू जारी रहन्छन् भने पेशेवर मद्दत (परामर्श/चिकित्सा) खोज्नुहोस्। मानसिक स्वास्थ्यलाई बेवास्ता नगर्नुहोस्।'
                }
            },
            // 20. Skin Fungal Infections
            'fungal': {
                icon: 'fa-spa', color: 'text-gray-500', name_en: 'Skin Fungal Infections', name_ne: 'छालाको फंगल संक्रमण',
                en: {
                    intro: 'Common skin infections like ringworm and athlete\'s foot, typically causing red, itchy, and scaly patches.',
                    causes: 'Fungi thriving in warm, moist environments, spread through contact with infected individuals or contaminated surfaces.',
                    aware: 'Keep skin clean and dry, especially in folds (groin, armpits, toes). Wear clean, breathable clothing. Avoid sharing towels and personal items.'
                },
                ne: {
                    intro: 'दाद र एथलीटको खुट्टा जस्ता सामान्य छाला संक्रमणहरू, जसले प्रायः रातो, चिलाउने र पाप्रो आउने दागहरू निम्त्याउँछ।',
                    causes: 'न्यानो, ओसिलो वातावरणमा फंगसहरू फस्टाउँछन्, जुन संक्रमित व्यक्तिहरू वा दूषित सतहहरूसँगको सम्पर्कबाट फैलिन्छ।',
                    aware: 'छालालाई सफा र सुख्खा राख्नुहोस्, विशेष गरी तहहरूमा (ग्रोइन, काखी, औंलाहरू)। सफा, सास फेर्ने लुगा लगाउनुहोस्। तौलिया र व्यक्तिगत सामानहरू साझा गर्नबाट जोगिनुहोस्।'
                }
            },
        };
        const diseaseKeys = Object.keys(nepoDiseaseData).slice(0, 20); 


        const nepoCareExamples_full = [
            { service: "Home Nurse Visit (Post-Op Care)", provider: "Shanti Health Services", date: "Sept 15, 2025", cost: 3500, icon: "fa-user-nurse" },
            { service: "Pediatric Tele-Consultation", provider: "Dr. R. Sharma", date: "Tomorrow, 10:00 AM", cost: 1200, icon: "fa-user-md" },
            { service: "Physiotherapy Session", provider: "KTM Rehab Center", date: "Scheduled", cost: 1800, icon: "fa-stethoscope" },
            { service: "Eldercare Giver (4 hours)", provider: "Community Help Group", date: "Oct 1, 2025", cost: 2000, icon: "fa-hand-holding-heart" },
            { service: "Mental Health Session", provider: "Counselor S. Thapa", date: "Scheduled", cost: 2500, icon: "fa-brain" }
        ];
        
        // --- UPDATED: 10 Second-Hand Examples ---
        const nepoSecondHandExamples_full = [
            { item: "iPhone 12 (128GB)", price: 45000, condition: "Excellent", location: "Pokhara", icon: "fa-mobile-screen-button" },
            { item: "Wooden Dining Table (6-seater)", price: 18000, condition: "Good", location: "Baneshwor", icon: "fa-couch" },
            { item: "Canon DSLR Camera (Used)", price: 32000, condition: "Fair", location: "Lalitpur", icon: "fa-camera" },
            { item: "Electric Scooter (2023 Model)", price: 75000, condition: "Like New", location: "Kathmandu", icon: "fa-motorcycle" },
            { item: "Old Nepali Coin Collection", price: 5000, condition: "Collectible", location: "Bhaktapur", icon: "fa-coins" },
            // Added 5 more
            { item: "Electric Guitar (Yamaha)", price: 12000, condition: "Good", location: "Thamel", icon: "fa-guitar" },
            { item: "Hiking Backpack (50L)", price: 3500, condition: "Excellent", location: "Godawari", icon: "fa-mountain" },
            { item: "Used Samsung Galaxy A50", price: 10000, condition: "Fair", location: "New Road", icon: "fa-mobile-alt" },
            { item: "Set of Clay Pots (Artisan)", price: 4000, condition: "New", location: "Patan", icon: "fa-bowl-food" },
            { item: "Office Desk and Chair Set", price: 9000, condition: "Good", location: "Kirtipur", icon: "fa-chair" }
        ];

        // --- UPDATED: 10 Shopping Examples ---
        const nepoShoppingExamples_full = [
            { item: "Traditional Dhaka Topi", price: 850, vendor: "Himalaya Weavers", status: "Shipped", icon: "fa-hat-cowboy" },
            { item: "Basmati Rice (25kg)", price: 2800, vendor: "Local Grocer", status: "Delivered", icon: "fa-wheat-awn" },
            { item: "Men's Jacket (Winter)", price: 4500, vendor: "Kathmandu Fashion", status: "Processing", icon: "fa-shirt" },
            { item: "Nepali Coffee Beans (500g)", price: 1200, vendor: "Organic Farms", status: "Delivered", icon: "fa-mug-saucer" },
            { item: "Set of Clay Pots", price: 1500, vendor: "Artisan Crafts", status: "Pending", icon: "fa-bowl-food" },
            // Added 5 more
            { item: "Smartwatch (Generic)", price: 3500, vendor: "Tech Nepal", status: "Shipped", icon: "fa-clock" },
            { item: "Electric Kettle (1.5L)", price: 1800, vendor: "Home Appliances", status: "Delivered", icon: "fa-blender" },
            { item: "Baby Diapers (Bulk)", price: 3200, vendor: "Mama & Baby Store", status: "Processing", icon: "fa-baby" },
            { item: "Set of Cooking Spices", price: 750, vendor: "Spicy Route", status: "Delivered", icon: "fa-pepper-hot" },
            { item: "Portable Bluetooth Speaker", price: 2100, vendor: "Audio World", status: "Pending", icon: "fa-volume-up" }
        ];

        // --- UPDATED: Visa Country Data Structure with Emojis ---
        const visaCountries = [
            { 
                name: "Australia", 
                flagEmoji: "🇦🇺",
                flagIcon: "fa-globe-asia", // Retain FA icon as fallback/theme element
                links: [
                    { name: "Visa Status Check", url: "https://online.immi.gov.au/evo/firstParty?actionType=query" }
                ]
            },
            { 
                name: "Indonesia", 
                flagEmoji: "🇮🇩",
                flagIcon: "fa-passport",
                links: [
                    { name: "Visa Check", url: "https://evisa.imigrasi.go.id/web/find-data" },
                    { name: "Work Permit Check", url: "https://evisa.imigrasi.go.id/web/find-data" }
                ]
            },
            { 
                name: "Albania", 
                flagEmoji: "🇦🇱",
                flagIcon: "fa-globe-europe",
                links: [
                    { name: "Visa Track", url: "https://e-visa.al/track" }
                ]
            },
            { 
                name: "Israel", 
                flagEmoji: "🇮🇱",
                flagIcon: "fa-passport",
                links: [
                    { name: "Passport Detail Check", url: "https://dofe.gov.np/PassportDetail.aspx" } 
                ]
            },
            { 
                name: "Kuwait", 
                flagEmoji: "🇰🇼",
                flagIcon: "fa-globe-asia",
                links: [
                    { name: "Visa Status", url: "https://rnt.moi.gov.kw/esrv/VisaStat.do?lang=eng#mobSec" }
                ]
            },
            { 
                name: "Maldives", 
                flagEmoji: "🇲🇻",
                flagIcon: "fa-umbrella-beach",
                links: [
                    { name: "Work Permit Check", url: "https://xpat.egov.mv/" }
                ]
            },
            { 
                name: "Malta", 
                flagEmoji: "🇲🇹",
                flagIcon: "fa-globe-europe",
                links: [
                    { name: "Visa Status Check", url: "https://identita.gov.mt/" }
                ]
            },
            { 
                name: "Oman", 
                flagEmoji: "🇴🇲",
                flagIcon: "fa-globe-asia",
                links: [
                    { name: "Visa Track", url: "https://evisa.rop.gov.om/en/track-your-application" }
                ]
            },
            { 
                name: "Romania", 
                flagEmoji: "🇷🇴",
                flagIcon: "fa-globe-europe",
                links: [
                    { name: "Passport Detail Check", url: "https://dofe.gov.np/PassportDetail.aspx" } 
                ]
            },
            { 
                name: "Serbia", 
                flagEmoji: "🇷🇸",
                flagIcon: "fa-globe-europe",
                links: [
                    { name: "e-Visa Status", url: "https://evisa.welcometoserbia.gov.rs/" }
                ]
            },
            { 
                name: "Republic of South Korea", 
                flagEmoji: "🇰🇷",
                flagIcon: "fa-globe-asia",
                links: [
                    { name: "Visa Status Check", url: "https://www.visa.go.kr/openPage.do?MENU_ID=10207" }
                ]
            },
            { 
                name: "Azerbaijan", 
                flagEmoji: "🇦🇿",
                flagIcon: "fa-globe-asia",
                links: [
                    { name: "e-Visa Status Check", url: "https://evisa.gov.az/en/check-status" }
                ]
            },
            { 
                name: "Bahrain", 
                flagEmoji: "🇧🇭",
                flagIcon: "fa-passport",
                links: [
                    { name: "Residency Status Check", url: "https://lmra.gov.bh/en/eligibilityrc" }
                ]
            },
            { 
                name: "Kyrgyzstan", 
                flagEmoji: "🇰🇬",
                flagIcon: "fa-globe-asia",
                links: [
                    { name: "e-Visa Status Check", url: "https://www.evisa.e-gov.kg/check_status.php" }
                ]
            },
            { 
                name: "Malaysia", 
                flagEmoji: "🇲🇾",
                flagIcon: "fa-passport",
                links: [
                    { name: "e-Visa Status Check", url: "https://malaysiavisa.imi.gov.my/evisa/vlno_checkstatus.jsp" }
                ]
            },
            { 
                name: "Poland", 
                flagEmoji: "🇵🇱",
                flagIcon: "fa-globe-europe",
                links: [
                    { name: "VFS Tracking", url: "https://www.vfsvisaonline.com/Global-Passporttracking/Track/Index?q=shSA0YnE4pLF9Xzwon/x/ASnHZRMROGDyz5YljrTPrmD7weWKDzHm/9+x4kyou3T7EbygDK+7ECJT8O+dWpxGw==" }
                ]
            },
            { 
                name: "Qatar", 
                flagEmoji: "🇶🇦",
                flagIcon: "fa-globe-asia",
                links: [
                    { name: "Visa Inquiry", url: "https://portal.moi.gov.qa/wps/portal/MOIInternet/services/inquiries/visaservices/enquiryandprinting" }
                ]
            },
            { 
                name: "Saudi Arabia", 
                flagEmoji: "🇸🇦",
                flagIcon: "fa-passport",
                links: [
                    { name: "Applicant Data Check", url: "https://visa.mofa.gov.sa/VisaPerson/GetApplicantData" }
                ]
            },
            { 
                name: "United Arab Emirates", 
                flagEmoji: "🇦🇪",
                flagIcon: "fa-building",
                links: [
                    { name: "Visa Inquiry (GDRFA)", url: "https://gdrfad.gov.ae/en/unified-number-inquiry-service" },
                    { name: "Work Permit Check (MOHRE)", url: "https://inquiry.mohre.gov.ae/" }
                ]
            },
        ];

        // This list is no longer used for the main Visa Check content, but retained for the history mock.
        const nepoVisaExamples_full = [
            { country: "Australia (Student Visa)", applicant: "Ramesh P.", status: "Processing", date: "Applied Mar '25", icon: "fa-graduation-cap" },
            { country: "USA (H1B Renewal)", applicant: "Sita G.", status: "Approved", date: "Expires Dec '26", icon: "fa-briefcase" },
            { country: "Canada (Visitor Visa)", applicant: "Prakash T.", status: "Denied", date: "Updated Today", icon: "fa-plane-up" },
            { country: "UK (Skilled Worker)", applicant: "Asha M.", status: "Interview Scheduled", date: "Oct 20, 2025", icon: "fa-hospital" },
            { country: "Japan (Training Visa)", applicant: "Dev K.", status: "Documents Submitted", date: "Next Update: 7 days", icon: "fa-wrench" },
            { country: "Germany (Family Reunion)", applicant: "Laxmi B.", status: "Approved", date: "Issued Jan '26", icon: "fa-house-user" },
            { country: "South Korea (E-9)", applicant: "Manoj R.", status: "Processing", date: "Applied Sept '25", icon: "fa-factory" },
            { country: "Portugal (Golden Visa)", applicant: "Hari N.", status: "Document Review", date: "Updated 3 days ago", icon: "fa-euro-sign" },
            { country: "UAE (Employment Visa)", applicant: "Kajal Y.", status: "Medical Clearance Pending", date: "Next Update: 14 days", icon: "fa-building-o" },
            { country: "India (Business Visa)", applicant: "Samir J.", status: "Approved", date: "Issued Dec '25", icon: "fa-business-time" }
        ];

        // --- UPDATED: 10 Donation Examples ---
        const nepoDonationExamples_full = [
            { cause: "Nepal Flood Relief Fund", amount: 5000, recipient: "National Disaster Authority", date: "Sept 1, 2025", type: "Disaster Relief", icon: "fa-house-tsunami" },
            { cause: "Community School Books Drive", amount: 1500, recipient: "Rural Education NGO", date: "Aug 20, 2025", type: "Education", icon: "fa-book" },
            { cause: "Animal Shelter Renovation", amount: 1000, recipient: "KTM Animal Welfare", date: "Pending", type: "Animal Care", icon: "fa-paw" },
            { cause: "Eldercare Food Program", amount: 2000, recipient: "Elderly Home Patan", date: "Monthly Recurring", type: "Social Welfare", icon: "fa-shield-heart" },
            { cause: "Local Temple Preservation", amount: 800, recipient: "Temple Committee", date: "Sept 5, 2025", type: "Culture", icon: "fa-gopuram" },
            // Added 5 more
            { cause: "COVID-19 Oxygen Supply", amount: 3000, recipient: "Private Hospital Fund", date: "April 10, 2024", type: "Health", icon: "fa-lungs-virus" },
            { cause: "Support Orphan Children", amount: 1200, recipient: "Nepal Children's Home", date: "July 7, 2025", type: "Social Welfare", icon: "fa-child" },
            { cause: "Digital Literacy Training", amount: 750, recipient: "Tech For All NGO", date: "Oct 15, 2025", type: "Education", icon: "fa-laptop" },
            { cause: "Environmental Cleanup Drive", amount: 500, recipient: "Eco-Friendly Nepal", date: "Nov 1, 2025", type: "Environment", icon: "fa-recycle" },
            { cause: "Blind School Braille Books", amount: 2500, recipient: "Blind Welfare Trust", date: "Dec 12, 2025", type: "Education", icon: "fa-braille" }
        ];

        // --- UPDATED: 10 Room Rent Examples ---
        const nepoRoomRentExamples_full = [
            { title: "Single Room near TU (Male/Student)", rent: 6000, deposit: 1, location: "Kirtipur", type: "Room", icon: "fa-door-open" },
            { title: "2BHK Apartment (Family Friendly)", rent: 25000, deposit: 2, location: "Boudha", type: "Apartment", icon: "fa-building" },
            { title: "Shared Flat for Females (Professional)", rent: 4500, deposit: 1, location: "New Baneshwor", type: "Shared", icon: "fa-users" },
            { title: "Ground Floor Shop/Studio Space", rent: 15000, deposit: 3, location: "Thamel", type: "Commercial", icon: "fa-shop" },
            { title: "Small House for Rent (Garden)", rent: 18000, deposit: 2, location: "Godawari", type: "House", icon: "fa-house" },
            // Added 5 more
            { title: "Hostel Bed (Clean & Safe)", rent: 3500, deposit: 1, location: "Lazimpat", type: "Shared", icon: "fa-bed" },
            { title: "1BHK Flat (Couple/Working Pro)", rent: 12000, deposit: 2, location: "Patan Dhoka", type: "Apartment", icon: "fa-building" },
            { title: "Large Godown for Storage/Light Industry", rent: 35000, deposit: 4, location: "Kalanki", type: "Commercial", icon: "fa-warehouse" },
            { title: "Room with Balcony (Female Pro)", rent: 7500, deposit: 1, location: "Chabahil", type: "Room", icon: "fa-door-open" },
            { title: "Modern 3BHK Penthouse", rent: 60000, deposit: 3, location: "Baluwatar", type: "Apartment", icon: "fa-city" }
        ];

        // --- UPDATED: 10 Jobs Examples ---
        const nepoJobsExamples_full = [
            { title: "Weekend Cafe Assistant", company: "Himalayan Brews", pay: "NPR 500/hr", location: "Thamel", type: "Hospitality", icon: "fa-mug-hot" },
            { title: "Freelance Graphic Designer", company: "Digital Solutions Co.", pay: "Project Based", location: "Remote", type: "Creative", icon: "fa-pen-nib" },
            { title: "After School Tutor (Maths/Science)", company: "Private Client", pay: "NPR 1000/session", location: "Lalitpur", type: "Education", icon: "fa-chalkboard-user" },
            { title: "Data Entry Specialist (Evening Shift)", company: "BPO Center", pay: "NPR 20k/month", location: "Baneshwor", type: "Admin", icon: "fa-keyboard" },
            { title: "Delivery Rider (Own Bike Required)", company: "Local Logistics", pay: "Per Delivery + Bonus", location: "KTM Area", type: "Logistics", icon: "fa-biking" },
            // Added 5 more
            { title: "Content Writer (Tech Niche)", company: "TechMedia Nepal", pay: "NPR 18k/month", location: "Remote", type: "Creative", icon: "fa-file-alt" },
            { title: "Housekeeping Staff (Part-Time)", company: "CleanPro Services", pay: "NPR 350/hr", location: "Lazimpat", type: "Service", icon: "fa-broom" },
            { title: "Customer Service Agent (Nepali/English)", company: "Telecom Support", pay: "NPR 25k/month", location: "Teku", type: "Call Center", icon: "fa-headset" },
            { title: "Social Media Intern", company: "Fashion Retailer", pay: "NPR 8k/month + Stipend", location: "New Road", type: "Marketing", icon: "fa-share-alt" },
            { title: "Waiter/Waitress (Hotel Experience)", company: "Luxury Hotel Patan", pay: "NPR 15k/month + Tips", location: "Patan", icon: "fa-bell-concierge" }
        ];

        const nepoWalletTransactions_full = [
            { type: "Payment Received", amount: 15000, source: "Freelance Client", date: "Oct 25, 2025", category: "Income", icon: "fa-arrow-down", color: "text-green-600" },
            { type: "Electricity Bill", amount: -2850, source: "Nepal Electricity", date: "Oct 24, 2025", category: "Utility", icon: "fa-plug", color: "text-red-600" },
            { type: "Mobile Top-up", amount: -500, source: "NTC", date: "Oct 24, 2025", category: "Communication", icon: "fa-mobile-alt", color: "text-red-600" },
            { type: "Mutual Fund Investment", amount: -10000, source: "Nepo Invest", date: "Oct 23, 2025", category: "Savings", icon: "fa-chart-line", color: "text-blue-600" },
            { type: "ATM Withdrawal", amount: -5000, source: "Bank Name", date: "Oct 22, 2025", category: "Cash", icon: "fa-money-bill-transfer", color: "text-gray-600" },
        ];

        const nepoExploreExamples_full = [
            { name: "Swayambhunath Stupa (Monkey Temple)", type: "Historic Site", distance: "4.5 km", rating: 4.8, icon: "fa-temple", color: 'text-amber-600' },
            { name: "Farmers Market at Patan", type: "Local Event", distance: "2.1 km", rating: 4.9, icon: "fa-seedling", color: 'text-green-600' },
            { name: "New Road Shopping Complex", type: "Shopping", distance: "7.0 km", rating: 4.3, icon: "fa-bag-shopping", color: 'text-purple-600' },
            { name: "Kathmandu Contemporary Art Center", type: "Culture & Arts", distance: "3.2 km", rating: 4.6, icon: "fa-palette", color: 'text-pink-600' },
            { name: "Sundarijal Waterfall Trek", type: "Nature & Outdoors", distance: "15 km", rating: 4.7, icon: "fa-mountain-sun", color: 'text-blue-600' },
        ];
        
        // This is used for the Profile and the Founder section
        const nepoProfileData = {
            // --- MODIFIED DATA START (Name change and icon removal retained) ---
            name: "Rajan Oli", 
            status: "Verified Platinum User",
            phone: "+977 98XXXXXXXX",
            email: "rajan.oli@example.com",
            address: "Boudha, Kathmandu",
            memberSince: "May 2023",
            nepoPoints: 1250, 
            securityStatus: "High (2FA Enabled)",
            // EXTENDED recentActivity to 30 entries
            recentActivity: [
                { type: "Ride", details: "Thamel to Airport (Completed)", date: "Oct 30", status: "Completed" },
                { type: "Shopping", details: "Dhaka Topi Purchase (Delivered)", date: "Oct 28", status: "Delivered" },
                { type: "SecondHand", details: "Bought iPhone 12 (45,000 NPR)", date: "Oct 26", status: "Completed" },
                { type: "Donation", details: "Flood Relief Fund (5,000 NPR)", date: "Oct 25", status: "Success" },
                { type: "Job", details: "Applied: Cafe Assistant", date: "Oct 24", status: "Pending" },
                { type: "Wallet", details: "Electricity Bill Payment (2,850 NPR)", date: "Oct 22", status: "Completed" },
                { type: "Care", details: "Booked Home Nurse Visit", date: "Oct 20", status: "Scheduled" },
                { type: "Ride", details: "Patan to Baneshwor (Completed)", date: "Oct 20", status: "Completed" },
                { type: "Visa", details: "AU Student Check (Processing)", date: "Oct 18", status: "Processing" },
                { type: "Wallet", details: "Received Freelance Pay (15,000 NPR)", date: "Oct 15", status: "Success" },
                { type: "RoomRent", details: "Viewed Kirtipur Listing", date: "Oct 10", status: "Viewed" },
                { type: "Shopping", details: "Nepali Coffee Beans (Delivered)", date: "Oct 08", status: "Delivered" },
                { type: "Explore", details: "Visited Swayambhunath Stupa", date: "Oct 01", status: "Completed" },
                { type: "Job", details: "Interviewed: Content Writer", date: "Sept 28", status: "Pending" },
                { type: "SecondHand", details: "Listed DSLR Camera", date: "Sept 25", status: "Active" },
                { type: "Wallet", details: "ATM Withdrawal (5,000 NPR)", date: "Sept 20", status: "Completed" },
                { type: "Ride", details: "Bhaktapur to Sanga Hill (Completed)", date: "Sept 18", status: "Completed" },
                { type: "Care", details: "Canceled: Physiotherapy", date: "Sept 15", status: "Cancelled" },
                { type: "Donation", details: "Animal Shelter (1,000 NPR)", date: "Sept 10", status: "Success" },
                { type: "Shopping", details: "Smartwatch Purchase (Shipped)", date: "Sept 5", status: "Shipped" },
                
                // Added 10 new history entries for testing scrolling
                { type: "Explore", details: "Booked Hiking Trip", date: "Sept 1", status: "Scheduled" },
                { type: "Visa", details: "UK Skilled Worker Check", date: "Aug 28", status: "Approved" },
                { type: "Wallet", details: "Received E-Sewa Transfer", date: "Aug 25", status: "Success" },
                { type: "RoomRent", details: "Paid Advance for New Flat", date: "Aug 20", status: "Completed" },
                { type: "Job", details: "Accepted Job Offer: BPO", date: "Aug 15", status: "Hired" },
                { type: "Ride", details: "Gongabu to Baneshwor", date: "Aug 10", status: "Completed" },
                { type: "Shopping", details: "Purchased Winter Boots", date: "Aug 5", status: "Delivered" },
                { type: "Donation", details: "Disaster Relief Fund", date: "Aug 1", status: "Success" },
                { type: "SecondHand", details: "Sold Old Phone (7,000 NPR)", date: "July 28", status: "Completed" },
                { type: "Care", details: "Annual Health Checkup", date: "July 25", status: "Completed" },
            ],
            // --- MODIFIED DATA END ---
            // --- UPDATED FOUNDER DATA START ---
            founder: {
                name: "Bipin Hamal",
                title: "IoT Student (3rd Semester) at Baekseok University, South Korea", // Updated title
                contact: "010-6708-3312",
                email: "bipinhamal2025@gmail.com"
            }
            // --- UPDATED FOUNDER DATA END ---
        };

        // --- Mock Pharmacy Data (New) - Unchanged for brevity ---
        const nepoPharmacyData = [
            {
                name: "Janata Pharmacy, Thamel",
                medicines: [
                    { name: "Paracetamol (500mg)", price: 5, stock: 150, category: "Pain Relief" },
                    { name: "Amoxicillin (250mg)", price: 20, stock: 80, category: "Antibiotic" },
                    { name: "Jivan Jal (ORS)", price: 40, stock: 200, category: "Electrolyte" },
                    { name: "Cetirizine (10mg)", price: 8, stock: 120, category: "Allergy" },
                    { name: "Amlodipine (5mg)", price: 15, stock: 50, category: "Hypertension" },
                    { name: "Metformin (500mg)", price: 12, stock: 65, category: "Diabetes" },
                    { name: "Ibuprofen (400mg)", price: 7, stock: 90, category: "Pain Relief" },
                    { name: "Omeprazole (20mg)", price: 10, stock: 110, category: "Antacid" },
                    { name: "Vitamin C (Chewable)", price: 2, stock: 300, category: "Supplement" },
                    { name: "Bandage Roll (Medium)", price: 50, stock: 45, category: "First Aid" },
                ]
            },
            {
                name: "Patan Health Mart",
                medicines: [
                    { name: "Azithromycin (500mg)", price: 55, stock: 40, category: "Antibiotic" },
                    { name: "Loratadine (10mg)", price: 10, stock: 75, category: "Allergy" },
                    { name: "Furosemide (40mg)", price: 18, stock: 30, category: "Diuretic" },
                    { name: "Insulin Pen (Short-acting)", price: 1200, stock: 15, category: "Diabetes" },
                    { name: "Dolo-650", price: 6, stock: 180, category: "Pain Relief" },
                    { name: "Diclofenac Gel", price: 80, stock: 55, category: "Topical" },
                    { name: "Zincovit Syrup (100ml)", price: 150, stock: 60, category: "Supplement" },
                    { name: "Domperidone (10mg)", price: 9, stock: 95, category: "Antiemetic" },
                    { name: "Gauze Pads (Sterile)", price: 30, stock: 70, category: "First Aid" },
                    { name: "Simvastatin (20mg)", price: 25, stock: 25, category: "Cholesterol" },
                ]
            },
            {
                name: "Boudha Medical Center Dispensary",
                medicines: [
                    { name: "Cefixime (200mg)", price: 45, stock: 50, category: "Antibiotic" },
                    { name: "Ranitidine (150mg)", price: 7, stock: 100, category: "Antacid" },
                    { name: "Ondansetron (4mg)", price: 22, stock: 35, category: "Antiemetic" },
                    { name: "Clopidogrel (75mg)", price: 30, stock: 20, category: "Cardiology" },
                    { name: "Eye Drop (Ciprofloxacin)", price: 150, stock: 40, category: "Ophthalmic" },
                    { name: "Nebulizer Solution", price: 60, stock: 70, category: "Respiratory" },
                    { name: "Hydrocortisone Cream", price: 90, stock: 60, category: "Topical" },
                    { name: "Calcium & D3 Tabs", price: 4, stock: 250, category: "Supplement" },
                    { name: "Dextromethorphan Syrup", price: 120, stock: 45, category: "Cough" },
                    { name: "Surgical Mask (N95)", price: 70, stock: 100, category: "PPE" },
                ]
            },
            {
                name: "Kathmandu Pharmacy Central",
                medicines: [
                    { name: "Codeine Cough Syrup", price: 250, stock: 20, category: "Cough" },
                    { name: "Lisinopril (10mg)", price: 14, stock: 55, category: "Hypertension" },
                    { name: "Montelukast (10mg)", price: 35, stock: 40, category: "Asthma" },
                    { name: "Atorvastatin (10mg)", price: 28, stock: 30, category: "Cholesterol" },
                    { name: "Metronidazole (400mg)", price: 11, stock: 90, category: "Antiparasitic" },
                    { name: "Fungal Cream (Clotrimazole)", price: 75, stock: 65, category: "Topical" },
                    { name: "Gastro-B (Probiotic)", price: 18, stock: 120, category: "Digestive" },
                    { name: "Thermometer (Digital)", price: 350, stock: 25, category: "Medical Device" },
                    { name: "Electrolyte Powder Sachets", price: 35, stock: 150, category: "Electrolyte" },
                    { name: "Cold-EZ Tablets", price: 10, stock: 80, category: "Cold Relief" },
                ]
            },
            {
                name: "Lalitpur Pharma Store",
                medicines: [
                    { name: "Levofloxacin (500mg)", price: 60, stock: 35, category: "Antibiotic" },
                    { name: "Oxycodone (5mg)", price: 80, stock: 10, category: "Pain Relief" },
                    { name: "Albuterol Inhaler", price: 600, stock: 15, category: "Asthma" },
                    { name: "Thyroxine (50mcg)", price: 9, stock: 70, category: "Hormone" },
                    { name: "Iron & Folic Acid Tabs", price: 3, stock: 200, category: "Supplement" },
                    { name: "Kidney Support Herbal Tea", price: 180, stock: 50, category: "Herbal" },
                    { name: "Infrared Lamp", price: 1500, stock: 5, category: "Medical Device" },
                    { name: "Gliclazide (80mg)", price: 17, stock: 45, category: "Diabetes" },
                    { name: "Eardrops (Antiseptic)", price: 110, stock: 60, category: "Otic" },
                    { name: "Antiseptic Wipes (Box)", price: 130, stock: 85, category: "First Aid" },
                ]
            },
            {
                name: "Swoyambhu Pharmacy & Health",
                medicines: [
                    { name: "Cough Lozenges (Mint)", price: 1, stock: 500, category: "Cough" },
                    { name: "Hydrochlorothiazide (25mg)", price: 13, stock: 40, category: "Diuretic" },
                    { name: "Multivitamin (A-Z)", price: 5, stock: 180, category: "Supplement" },
                    { name: "Hand Sanitizer (500ml)", price: 250, stock: 100, category: "Hygiene" },
                    { name: "Povidone-iodine Solution", price: 85, stock: 75, category: "First Aid" },
                    { name: "Glucosamine Sulphate", price: 45, stock: 30, category: "Joint Health" },
                    { name: "Calamine Lotion", price: 100, stock: 60, category: "Topical" },
                    { name: "ORS Zink Combo", price: 70, stock: 90, category: "Electrolyte" },
                    { name: "Nimesulide (100mg)", price: 18, stock: 55, category: "Pain Relief" },
                    { name: "Paracetamol Syrup (Pedi)", price: 95, stock: 70, category: "Pain Relief" },
                ]
            },
            {
                name: "Balaju Pharma Supply",
                medicines: [
                    { name: "Warfarin (5mg)", price: 20, stock: 20, category: "Cardiology" },
                    { name: "Sertraline (50mg)", price: 40, stock: 15, category: "Mental Health" },
                    { name: "Potassium Chloride", price: 15, stock: 80, category: "Electrolyte" },
                    { name: "Infant Formula (Stage 1)", price: 2200, stock: 10, category: "Maternity" },
                    { name: "Tetanus Vaccine", price: 400, stock: 5, category: "Vaccine" },
                    { name: "Gynaecological Cream", price: 190, stock: 35, category: "Women's Health" },
                    { name: "Magnesium Tablets", price: 8, stock: 150, category: "Supplement" },
                    { name: "Anti-Diarrheal Caps", price: 12, stock: 90, category: "Digestive" },
                    { name: "Blood Pressure Monitor", price: 3500, stock: 8, category: "Medical Device" },
                    { name: "Gloves (Sterile Pair)", price: 15, stock: 120, category: "First Aid" },
                ]
            },
            {
                name: "New Road Chemist",
                medicines: [
                    { name: "Finasteride (1mg)", price: 55, stock: 25, category: "Hair/Skin" },
                    { name: "Viagra (Sildenafil)", price: 150, stock: 5, category: "Men's Health" },
                    { name: "Nicotine Gum", price: 40, stock: 30, category: "Smoking Cessation" },
                    { name: "Propranolol (40mg)", price: 16, stock: 60, category: "Cardiology" },
                    { name: "Sunscreen (SPF 50)", price: 450, stock: 50, category: "Skin Care" },
                    { name: "Painkiller Spray", price: 200, stock: 40, category: "Pain Relief" },
                    { name: "Throat Spray (Antiseptic)", price: 130, stock: 75, category: "Throat" },
                    { name: "Diaper Rash Cream", price: 110, stock: 65, category: "Maternity" },
                    { name: "Zinc Sulphate Tabs", price: 7, stock: 100, category: "Supplement" },
                    { name: "Cold Compress Gel Pack", price: 180, stock: 45, category: "First Aid" },
                ]
            },
            {
                name: "Airport Road Pharma",
                medicines: [
                    { name: "Travel Sickness Tabs", price: 15, stock: 70, category: "Travel" },
                    { name: "Ivermectin (12mg)", price: 90, stock: 25, category: "Antiparasitic" },
                    { name: "B Complex Forte", price: 10, stock: 150, category: "Supplement" },
                    { name: "Migraine Relief Tablets", price: 30, stock: 55, category: "Pain Relief" },
                    { name: "Pregnancy Test Kit", price: 100, stock: 40, category: "Maternity" },
                    { name: "Saline Nasal Spray", price: 120, stock: 60, category: "Respiratory" },
                    { name: "First Aid Kit (Complete)", price: 1500, stock: 10, category: "First Aid" },
                    { name: "Laxative Powder", price: 80, stock: 50, category: "Digestive" },
                    { name: "Diabetic Foot Cream", price: 280, stock: 35, category: "Diabetes" },
                    { name: "Disinfectant Liquid (1L)", price: 350, stock: 80, category: "Hygiene" },
                ]
            },
            {
                name: "Godavari Herbs & Pharma",
                medicines: [
                    { name: "Ashwagandha Powder", price: 300, stock: 60, category: "Herbal" },
                    { name: "Turmeric Capsules", price: 150, stock: 80, category: "Herbal" },
                    { name: "Ginseng Extract", price: 400, stock: 40, category: "Herbal" },
                    { name: "Ayurvedic Pain Balm", price: 90, stock: 120, category: "Topical" },
                    { name: "Blood Purifier Syrup", price: 180, stock: 55, category: "Herbal" },
                    { name: "Stress Relief Oil (Aromatherapy)", price: 250, stock: 70, category: "Mental Health" },
                    { name: "Chyawanprash (500g)", price: 650, stock: 30, category: "Supplement" },
                    { name: "Pillow for Back Pain", price: 900, stock: 15, category: "Medical Device" },
                    { name: "Tea Tree Oil (Antifungal)", price: 160, stock: 45, category: "Topical" },
                    { name: "Herbal Detox Tea", price: 120, stock: 100, category: "Herbal" },
                ]
            }
        ];
        // --- End Mock Pharmacy Data ---
        
        // Global state for language
        let currentLang = 'en'; 
        // Global state for the active tab (either 'awareness' or 'pharmacy')
        let currentCareTab = 'awareness'; 

        // --- Core Functions ---

        function displayForecast() {
            const forecastEl = document.getElementById('weather-forecast');
            if (forecastEl) {
                const randomForecast = forecastMessages[Math.floor(Math.random() * forecastMessages.length)];
                
                // Use JSON.stringify and encodeURIComponent to safely pass the object in the onclick handler
                const forecastJson = encodeURIComponent(JSON.stringify(randomForecast));
                
                forecastEl.innerHTML = `
                    <div class="flex items-center w-full cursor-pointer" onclick="openForecastModal('${forecastJson}')">
                        <i class="fas ${randomForecast.icon} text-lg mr-2 ${randomForecast.color}"></i>
                        <span class="text-sm font-medium">${randomForecast.message}</span>
                        <i class="fas fa-chevron-right text-xs ml-auto opacity-70"></i>
                    </div>
                `;
            }
        }

        /**
         * Renders the dynamic content for the App Info Modal (Founder Contact) in a formatted box.
         */
        function renderAppInfoContent() {
            const founderContainer = document.getElementById('founder-contact-container');
            const founderData = nepoProfileData.founder;
            
            if (founderContainer) {
                // Ensure phone number is cleaned for tel: link and displayed with dashes
                const cleanContact = founderData.contact.replace(/-/g, '');

                const contactHtml = `
                    <div class="bg-indigo-100 p-4 rounded-xl shadow-inner border border-indigo-300">
                        <h4 class="font-bold text-base text-indigo-800 mb-2 border-b border-indigo-300 pb-1">
                            <i class="fas fa-code-branch mr-2"></i> Founder/Developer Contact
                        </h4>
                        <div class="space-y-1 text-sm text-gray-800">
                            <!-- Name and Title -->
                            <div class="flex">
                                <span class="font-bold w-1/3 min-w-[70px] text-gray-600">Name:</span>
                                <span class="flex-1">${founderData.name}</span>
                            </div>
                            <div class="flex">
                                <span class="font-bold w-1/3 min-w-[70px] text-gray-600">Role:</span>
                                <span class="flex-1 text-xs">${founderData.title}</span>
                            </div>
                            
                            <hr class="border-indigo-200 my-2">
                            
                            <!-- Email Link -->
                            <div class="flex items-center">
                                <i class="fas fa-envelope mr-2 text-indigo-600 w-4 text-center"></i>
                                <span class="font-bold text-gray-600 mr-2">Email:</span>
                                <a href="mailto:${founderData.email}" class="text-indigo-600 hover:underline flex-1 truncate">${founderData.email}</a>
                            </div>
                            
                            <!-- Contact/WhatsApp Link -->
                            <div class="flex items-center">
                                <i class="fas fa-phone-alt mr-2 text-indigo-600 w-4 text-center"></i>
                                <span class="font-bold text-gray-600 mr-2">Contact:</span>
                                <a href="tel:${cleanContact}" class="text-indigo-600 hover:underline">${founderData.contact}</a> 
                                <span class="text-xs text-gray-500 ml-2 flex-shrink-0">(Call/WhatsApp)</span>
                            </div>
                            
                            <div class="text-xs italic pt-2 text-indigo-700 text-center border-t border-indigo-200 mt-2">
                                <i class="fas fa-lightbulb mr-1"></i> Suggestions are always welcome via mail!
                            </div>
                        </div>
                    </div>
                `;
                founderContainer.innerHTML = contactHtml;
            }
        }


        function openAppInfoModal() {
            const infoModal = document.getElementById('app-info-modal');
            if (infoModal) {
                // RENDER FIX: Dynamically inject founder data just before opening the modal
                renderAppInfoContent(); 
                infoModal.classList.remove('hidden');
            }
        }
        window.openAppInfoModal = openAppInfoModal;


        async function initializeFirebase() {
            // Check if API key is a placeholder
            if (firebaseConfig.apiKey === "YOUR_API_KEY_HERE" || !firebaseConfig.apiKey || !firebaseConfig.projectId) {
                console.warn("⚠️ Firestore is in DEMO MODE. Please replace placeholder config for database features (e.g., Nepo Driving) to work.");
                isAuthReady = true; 
                isFirebaseActive = false;
                window.dispatchEvent(new CustomEvent('authReady'));
                loadServiceData();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                isFirebaseActive = true;

                // Authentication listener
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Authenticated User ID:", userId);
                    } else {
                        // Sign in anonymously if no user is authenticated
                        try {
                            await signInAnonymously(auth);
                            userId = auth.currentUser.uid;
                            console.log("Signed in anonymously. User ID:", userId);
                        } catch (error) {
                            console.error("Anonymous sign-in failed:", error);
                        }
                    }
                    isAuthReady = true;
                    window.dispatchEvent(new CustomEvent('authReady'));

                    loadServiceData();
                    setupRealtimeServices();
                });

                // Use custom token if provided
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Signed in with custom token.");
                } else {
                    // Fallback to anonymous sign-in if no token is available (listener will handle it too)
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                displayMessage(`Firebase error: ${error.code}. Running in demo mode.`, 'error');
                isAuthReady = true; 
                isFirebaseActive = false;
                window.dispatchEvent(new CustomEvent('authReady'));
                loadServiceData();
            }
        }

        // --- Firestore Utilities (Guarded for Demo Mode) ---

        function getServiceCollectionRef(serviceKey) {
            if (!isFirebaseActive || !db || !userId) throw new Error("Firestore is not active, initialized, or user is not ready.");
            // Using a Public path for multi-user collaboration visibility of active ride requests
            const path = `artifacts/${appId}/public/data/driving_requests`; 
            return collection(db, path);
        }

        async function addItem(serviceKey, itemData) {
            if (!isFirebaseActive) {
                return displayMessage("Cannot add item. App is in DEMO MODE (Missing Firebase Key).", 'warning');
            }
            if (!isAuthReady || !userId) return console.warn("Auth not ready. Cannot add item.");
            try {
                const docRef = await addDoc(getServiceCollectionRef(serviceKey), {
                    ...itemData,
                    createdBy: userId,
                    createdAt: serverTimestamp()
                });
                console.log("Document written with ID: ", docRef.id);
                return true;
            } catch (e) {
                console.error("Error adding document: ", e);
                displayMessage(`Error adding item: ${e.message}`, 'error');
                return false;
            }
        }

        // Realtime Listener for Services (Only for 'Nepo Driving' demo)
        function setupRealtimeServices() {
            if (!isFirebaseActive || !isAuthReady || !db || !userId) return;
            
            const serviceKey = 'driving';
            try {
                // Query for active (status 'requested') ride requests
                const q = query(
                    getServiceCollectionRef(serviceKey), 
                    where("status", "==", "requested")
                );

                onSnapshot(q, (snapshot) => {
                    const items = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        items.push({ id: doc.id, ...data, 
                            // Convert Firestore Timestamp to Date object if needed
                            createdAt: data.createdAt ? (data.createdAt.toDate ? data.createdAt.toDate() : data.createdAt) : null
                        });
                    });
                    updateServiceView(serviceKey, items);
                }, (error) => {
                    console.error(`Error listening to ${serviceKey} collection: `, error);
                });
            } catch (e) {
                console.error("Failed to set up real-time listener:", e);
            }
        }

        // --- UI Logic and Data Handling (Including Nepo Care Language Toggle and Pharmacy Tabs) ---

        let currentService = null;
        const serviceModalEl = document.getElementById('service-modal');
        const modalTitleEl = document.getElementById('modal-title');
        const modalContentEl = document.getElementById('modal-content');

        // Initial mock data for the 'driving' list before any potential DB load
        let serviceData = {
            driving: [] 
        };
        

        // Functions for Nepo Care Language Toggle
        function switchLanguage(lang) {
            currentLang = lang;
            
            // 1. Update button styling
            const langEnBtn = document.getElementById('lang-en');
            const langNeBtn = document.getElementById('lang-ne');
            
            if (langEnBtn && langNeBtn) {
                langEnBtn.classList.remove('bg-indigo-600', 'text-white', 'bg-gray-200', 'text-gray-700');
                langNeBtn.classList.remove('bg-indigo-600', 'text-white', 'bg-gray-200', 'text-gray-700');
                
                if (lang === 'en') {
                    langEnBtn.classList.add('bg-indigo-600', 'text-white');
                    langNeBtn.classList.add('bg-gray-200', 'text-gray-700');
                } else {
                    langNeBtn.classList.add('bg-indigo-600', 'text-white');
                    langEnBtn.classList.add('bg-gray-200', 'text-gray-700');
                }
            }


            // 2. Toggle visibility of language-specific elements (list & footer)
            document.querySelectorAll('.disease-name-en').forEach(el => el.classList.toggle('hidden', lang !== 'en'));
            document.querySelectorAll('.disease-name-ne').forEach(el => el.classList.toggle('hidden', lang !== 'ne'));
            document.querySelectorAll('.footer-en').forEach(el => el.classList.toggle('hidden', lang !== 'en'));
            document.querySelectorAll('.footer-ne').forEach(el => el.classList.toggle('hidden', lang !== 'ne'));
            
            // 3. Re-render the details section with the new language
            // Find the currently selected disease button (highlighted with bg-indigo-200)
            const currentSelectedButton = document.querySelector('#disease-list-buttons button.bg-indigo-200');
            // Use the key from the selected button, or default to the first disease if none is selected
            const diseaseKey = currentSelectedButton ? currentSelectedButton.getAttribute('data-disease-key') : diseaseKeys[0]; 
            
            if (diseaseKey) {
                // IMPORTANT: Pass the new language here, which updates the view.
                showDiseaseDetails(diseaseKey, lang);
            } else if (document.getElementById('disease-details-display').innerHTML === '') {
                // If the modal is opened for the first time and language is switched before clicking a button,
                // load the default content in the new language.
                showDiseaseDetails(diseaseKeys[0], lang); 
            }
        }

        function showDiseaseDetails(diseaseKey, lang) {
            const data = nepoDiseaseData[diseaseKey];
            // Ensure the language passed is the active one, defaulting to the current global state if needed
            const actualLang = lang || currentLang;
            const content = data[actualLang];
            
            if (!data || !content) {
                console.error(`Error: Data not found for diseaseKey: ${diseaseKey} and language: ${actualLang}`);
                return;
            }

            // Update button active state
            document.querySelectorAll('#disease-list-buttons button').forEach(btn => {
                btn.classList.remove('bg-indigo-200', 'font-bold');
                btn.classList.add('bg-white', 'font-normal');
            });
            const activeBtn = document.querySelector(`button[data-disease-key="${diseaseKey}"]`);
            if(activeBtn) {
                 activeBtn.classList.remove('bg-white', 'font-normal');
                 activeBtn.classList.add('bg-indigo-200', 'font-bold');
            }
           
            
            const detailsHtml = `
                <h4 class="text-xl font-extrabold mb-3 text-gray-900">${actualLang === 'en' ? data.name_en : data.name_ne}</h4>
                
                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                    <p class="font-semibold text-indigo-700 text-sm mb-1">${actualLang === 'en' ? 'I. Introduction:' : '१. परिचय:'}</p>
                    <p class="text-sm text-gray-700">${content.intro}</p>
                </div>
                
                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                    <p class="font-semibold text-indigo-700 text-sm mb-1">${actualLang === 'en' ? 'II. Causes:' : '२. कारणहरू:'}</p>
                    <p class="text-sm text-gray-700">${content.causes}</p>
                </div>
                
                <div class="mb-4">
                    <p class="font-semibold text-indigo-700 text-sm mb-1">${actualLang === 'en' ? 'III. Prevention & Awareness (Formal Suggestion):' : '३. रोकथाम र सचेतना (औपचारिक सुझाव):'}</p>
                    <div class="p-3 bg-green-100 rounded-lg border border-green-300 shadow-sm">
                        <p class="text-sm text-green-800 font-medium">${content.aware}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('disease-details-display').innerHTML = detailsHtml;
        }

        // Must attach these functions to the window object to be called from inline HTML
        window.switchLanguage = switchLanguage;
        window.showDiseaseDetails = showDiseaseDetails;
        
        // Function to switch between the care service tabs (awareness/pharmacy)
        function switchCareTab(tab) {
            currentCareTab = tab;
            
            // Update button styling
            document.getElementById('tab-awareness').classList.remove('bg-indigo-600', 'text-white', 'bg-gray-200', 'text-gray-700');
            document.getElementById('tab-pharmacy').classList.remove('bg-indigo-600', 'text-white', 'bg-gray-200', 'text-gray-700');
            
            if (tab === 'awareness') {
                document.getElementById('tab-awareness').classList.add('bg-indigo-600', 'text-white');
                document.getElementById('tab-pharmacy').classList.add('bg-gray-200', 'text-gray-700');
                
                // Set language buttons appropriately when returning to awareness
                switchLanguage(currentLang);
            } else {
                document.getElementById('tab-pharmacy').classList.add('bg-indigo-600', 'text-white');
                document.getElementById('tab-awareness').classList.add('bg-gray-200', 'text-gray-700');
            }
            
            // Toggle content visibility
            document.getElementById('care-content-awareness').classList.toggle('hidden', tab !== 'awareness');
            document.getElementById('care-content-pharmacy').classList.toggle('hidden', tab !== 'pharmacy');
            
            // If switching to pharmacy, re-run the filter to display initial list
            if (tab === 'pharmacy') {
                filterMedicines(); 
            }
        }
        window.switchCareTab = switchCareTab; // Expose to window

        // Function to search/filter the medicines (New)
        function filterMedicines() {
            const searchTerm = document.getElementById('medicine-search').value.toLowerCase();
            const storeListEl = document.getElementById('pharmacy-store-list');
            
            if (!storeListEl) return;

            let filteredHtml = '';
            let matchCount = 0;

            nepoPharmacyData.forEach(store => {
                const matchingMedicines = store.medicines.filter(med => 
                    med.name.toLowerCase().includes(searchTerm) || 
                    med.category.toLowerCase().includes(searchTerm)
                );

                if (matchingMedicines.length > 0) {
                    matchCount++;
                    filteredHtml += `
                        <div class="mb-4 p-3 bg-white border border-gray-200 rounded-xl shadow-sm">
                            <h4 class="font-bold text-base text-teal-700 border-b pb-1 mb-2">${store.name} <span class="text-xs font-normal text-gray-500 ml-2">(${matchingMedicines.length} match${matchingMedicines.length !== 1 ? 'es' : ''})</span></h4>
                            <div class="space-y-2 text-sm">
                                ${matchingMedicines.map(med => `
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-800">${med.name}</span>
                                        <div class="text-right">
                                            <span class="font-semibold text-gray-700">NPR ${med.price.toLocaleString()}</span>
                                            <p class="text-xs text-gray-500">${med.category} | <span class="${med.stock > 50 ? 'text-green-500' : med.stock > 15 ? 'text-orange-500' : 'text-red-500'}">${med.stock} in stock</span></p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            if (matchCount === 0) {
                storeListEl.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <i class="fas fa-box-open text-4xl mb-3"></i>
                        <p>No medicines found matching your search term: **"${searchTerm}"**.</p>
                        <p class="text-xs mt-2">Try a different name or category (e.g., 'Pain Relief', 'Antibiotic').</p>
                    </div>
                `;
            } else {
                storeListEl.innerHTML = filteredHtml;
            }
        }
        window.filterMedicines = filterMedicines; // Expose to window


        function updateServiceView(serviceKey, items) {
            serviceData[serviceKey] = items;
            // Only re-render the modal if it's the currently open service
            if (currentService === serviceKey) {
                renderModalContent(serviceKey);
            }
        }

        function openModal(serviceKey) {
            currentService = serviceKey;
            const service = serviceMap[serviceKey];
            
            modalTitleEl.textContent = service ? service.name : (serviceKey === 'wallet' ? 'My Wallet' : serviceKey === 'explore' ? 'Explore Local' : serviceKey === 'profile' ? 'My Profile' : 'Service Details');
            
            serviceModalEl.classList.remove('hidden');

            renderModalContent(serviceKey);
        }

        function closeModal() {
            serviceModalEl.classList.add('hidden');
            modalContentEl.innerHTML = '';
            currentService = null;
        }
        
        function openGreeting() {
            const greetingModal = document.getElementById('greeting-modal');
            if (greetingModal) {
                setTimeout(() => {
                    greetingModal.classList.remove('hidden');
                }, 500); 
            }
        }
        window.openGreeting = openGreeting; 
        window.openForecastModal = openForecastModal;


        function openForecastModal(forecastJson) {
            const currentForecast = JSON.parse(decodeURIComponent(forecastJson));
            
            currentService = 'weather_forecast'; 
            
            modalTitleEl.textContent = "Today's Weather & Outlook";
            serviceModalEl.classList.remove('hidden');

            renderForecastModalContent(currentForecast);
        }

        function renderForecastModalContent(current) {
            const todayData = sevenDayForecast[0];

            let html = `<div class="p-4">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Current Conditions</h3>
                
                <div class="p-6 rounded-xl shadow-lg mb-6 bg-indigo-50 text-gray-800 border-l-4 border-indigo-500">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-4xl font-extrabold">${todayData.temp.split(' / ')[0]}</span>
                        <i class="fas ${todayData.icon} text-5xl text-indigo-500"></i>
                    </div>
                    <p class="text-lg font-semibold mb-1">${current.message.split(':')[0]}</p>
                    <p class="text-sm text-gray-600 font-medium">${current.message.split(': ')[1] || current.message}</p>
                    <hr class="my-3 border-gray-200">
                    <div class="flex justify-between text-xs text-gray-500 font-medium">
                        <span><i class="fas fa-wind mr-1"></i> Wind: ${todayData.wind}</span>
                        <span><i class="fas fa-temperature-three-quarters mr-1"></i> High/Low: ${todayData.temp}</span>
                    </div>
                </div>

                <h3 class="text-lg font-semibold mb-3 text-gray-800">7-Day Outlook</h3>
                <div class="space-y-2 max-h-[45vh] scrollable-content overflow-y-auto pb-4">
                    ${sevenDayForecast.map((day, index) => `
                        <div class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-xl ${index === 0 ? 'shadow-md border-indigo-200' : 'shadow-sm'}">
                            <span class="text-sm font-medium ${index === 0 ? 'text-indigo-600' : 'text-gray-700'}">${day.day}</span>
                            <div class="flex items-center text-xs text-gray-500 w-32 justify-end">
                                <i class="fas ${day.icon} mr-2 text-base w-4 text-center"></i>
                                <span>${day.condition}</span>
                            </div>
                            <div class="text-right">
                                <span class="text-sm font-semibold">${day.temp}</span>
                                <p class="text-xs text-gray-400">Wind: ${day.wind}</p>
                            </div>
                        </div>
                    `).join('')}
                    <div class="text-center p-4 text-gray-400 text-sm">-- Forecast provided by Nepo Weather --</div>
                </div>
            </div>`;
            modalContentEl.innerHTML = html;
        }

        // ----------------------------------------------
        // NEW FUNCTIONS FOR PROFILE INTERACTION START
        // ----------------------------------------------

        // Renders the combined Contact Details and Recent Activity view (expanded view)
        function showDetails() {
            const profile = nepoProfileData;
            
            // Set modal title to only display "Recent Nepo Activity"
            document.getElementById('modal-title').textContent = "Recent Nepo Activity";

            // --- START MODIFIED HTML (REMOVED MEMBERSHIP DETAILS and fixed scrolling) ---
            const contactActivityHtml = `<div class="p-4">
                <div class="text-center mb-4 sticky top-0 bg-white z-10 pt-2 pb-2 border-b border-gray-200">
                    <button onclick="renderProfileContent('full')" class="text-indigo-600 hover:text-indigo-800 font-semibold mb-2 flex items-center mx-auto">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Profile Summary
                    </button>
                    <h3 class="text-xl font-bold text-gray-900">Activity Timeline</h3>
                </div>

                <div id="activity-list-container-anchor"></div> 
                
                <div class="mt-4">
                    <h4 class="text-lg font-bold text-gray-800 mb-3">All Recent Actions (${profile.recentActivity.length})</h4>
                    
                    <!-- SCROLLING FIX APPLIED HERE: Added max-h-[70vh] and scrollable-content -->
                    <div class="space-y-4 pb-4 max-h-[70vh] scrollable-content overflow-y-auto">
                        ${profile.recentActivity.map(activity => `
                            <div class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-xl shadow-sm">
                                <div class="flex items-center">
                                    <div class="w-1 mr-3"></div> 
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${activity.type}: ${activity.details}</p>
                                        <p class="text-xs text-gray-400">${activity.date}</p>
                                    </div>
                                </div>
                                <span class="text-xs font-semibold flex-shrink-0 ml-1 ${activity.status === 'Completed' || activity.status === 'Delivered' || activity.status === 'Success' || activity.status === 'Active' || activity.status === 'Hired' ? 'text-green-600' : activity.status === 'Pending' || activity.status === 'Scheduled' || activity.status === 'Processing' ? 'text-orange-600' : 'text-gray-500'}">${activity.status}</span>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of activity --</div>
                    </div>
                </div>
                
            </div>`;
            // --- END MODIFIED HTML (REMOVED MEMBERSHIP DETAILS and fixed scrolling) ---
            modalContentEl.innerHTML = contactActivityHtml;
            // Ensure the main scrollable container scrolls to top
            document.getElementById('modal-content').scrollTop = 0;
        }
        window.showDetails = showDetails; // Expose to window

        // Renders the main Profile view (initial state)
        function renderProfileContent(viewState) {
            const profile = nepoProfileData;

            // Reset title if coming back from detailed view
            if (viewState === 'full') {
                 document.getElementById('modal-title').textContent = "My Profile";
            }
            
            let html = `<div class="p-4">
                <div class="flex flex-col items-center p-4 bg-gray-50 rounded-xl shadow-inner mb-6">
                    <!-- RESIZED PROFILE ICON: Smaller (w-16 h-16) and smaller font (text-2xl) -->
                    <div class="w-16 h-16 rounded-full bg-indigo-500 text-white flex items-center justify-center text-2xl font-bold mb-2 border-4 border-white shadow-lg">
                        ${profile.name[0]}
                    </div>
                    <p class="text-xl font-bold text-gray-900">${profile.name}</p>
                    <p class="text-sm font-medium ${profile.status.includes('Platinum') ? 'text-amber-600' : 'text-green-600'}">${profile.status}</p>

                    <div class="mt-3 p-2 bg-amber-100 rounded-lg w-full text-center">
                        <p class="text-sm font-semibold text-amber-700">
                            <i class="fas fa-medal mr-1"></i> Nepo Points: ${profile.nepoPoints.toLocaleString()}
                        </p>
                    </div>
                </div>

                <div onclick="showDetails()" class="cursor-pointer mb-6 p-4 rounded-xl transition hover:bg-gray-100 border border-gray-200 shadow-md">
                    
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">Contact & Membership</h3>
                        <i class="fas fa-chevron-right text-sm text-indigo-500"></i>
                    </div>

                    <div class="space-y-2">
                        <div class="flex items-center text-sm text-gray-700">
                            <i class="fas fa-phone-alt text-sm text-center text-indigo-500 mr-2 w-3"></i>
                            <span class="text-sm">${profile.phone}</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-700">
                            <i class="fas fa-envelope text-sm text-center text-indigo-500 mr-2 w-3"></i>
                            <span class="text-sm">${profile.email}</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-700">
                            <i class="fas fa-map-marker-alt text-sm text-center text-indigo-500 mr-2 w-3"></i>
                            <span class="text-sm">${profile.address}</span>
                        </div>
                    </div>
                </div>
                
                </div>`;
            modalContentEl.innerHTML = html;
        }
        window.renderProfileContent = renderProfileContent; // Expose to window
        
        // ----------------------------------------------
        // NEW FUNCTIONS FOR VISA CHECK SERVICE START
        // ----------------------------------------------
        
        /**
         * Renders the main list of countries for the Visa Check service.
         */
        function renderVisaCheckList() {
            modalTitleEl.textContent = 'Visa & Work Permit Status Check';

            const html = `<div class="p-4">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Select a Country/Region (${visaCountries.length})</h3>
                <p class="text-sm text-gray-500 mb-4">Official portals to check visa, permit, or residency application status.</p>
                <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                    ${visaCountries.map((country, index) => `
                        <button onclick="openCountryLinksModal(${index})" 
                            class="w-full text-left p-3 bg-white border border-gray-200 rounded-xl shadow-sm flex items-center justify-between hover:bg-gray-50 transition duration-150">
                            <div class="flex items-center">
                                <!-- Flag Emoji for visual distinctiveness -->
                                <span class="text-xl mr-3 w-5 text-center">${country.flagEmoji}</span>
                                <span class="font-medium text-base text-gray-800">${country.name}</span>
                            </div>
                            <!-- Show a badge if multiple links exist -->
                            ${country.links.length > 1 ? `
                                <span class="text-xs font-bold text-white bg-red-500 rounded-full px-2 py-0.5 ml-2">${country.links.length} Options</span>
                            ` : ''}
                            <i class="fas fa-chevron-right text-sm text-gray-400"></i>
                        </button>
                    `).join('')}
                    <div class="text-center p-4 text-gray-400 text-sm">-- End of country list --</div>
                </div>
            </div>`;

            modalContentEl.innerHTML = html;
        }
        window.renderVisaCheckList = renderVisaCheckList; // Expose to window

        /**
         * Opens a sub-modal to show the specific link buttons for a selected country.
         */
        function openCountryLinksModal(countryIndex) {
            const country = visaCountries[countryIndex];
            if (!country) return;

            // If there is only one link, open it directly in a new browser tab.
            if (country.links.length === 1) {
                // Use _blank to open in a new tab/browser window (Standard HTML behavior)
                window.open(country.links[0].url, '_blank');
                // Display a message that the external link was opened
                displayMessage(`Opening ${country.name} - ${country.links[0].name} in new browser tab...`, 'info');
                return; 
            }

            // If there are multiple links, render the sub-menu in the modal.
            modalTitleEl.textContent = `${country.name} - Select Check Type`;
            
            const linksHtml = `<div class="p-4">
                <button onclick="renderVisaCheckList()" class="text-indigo-600 hover:text-indigo-800 font-semibold mb-6 flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Country List
                </button>

                <h3 class="text-xl font-semibold mb-4 text-gray-800">Check Options for ${country.name}</h3>
                <p class="text-sm text-gray-500 mb-6">Tap the link to open the official portal in your device's browser.</p>
                
                <div class="space-y-4">
                    ${country.links.map(link => `
                        <!-- External browser opening, using target="_blank" -->
                        <a href="${link.url}" target="_blank" onclick="displayMessage('Opening ${country.name} - ${link.name} in new browser tab...', 'info')" class="block">
                            <div class="w-full py-4 px-6 bg-indigo-100 border border-indigo-300 text-indigo-800 font-bold rounded-xl shadow-md flex items-center justify-between hover:bg-indigo-200 transition">
                                <!-- Dynamic inside-buttons -->
                                <span><i class="fas fa-external-link-alt text-sm mr-2"></i> ${link.name}</span>
                                <i class="fas fa-angle-right"></i>
                            </div>
                        </a>
                    `).join('')}
                </div>
            </div>`;

            modalContentEl.innerHTML = linksHtml;
        }
        window.openCountryLinksModal = openCountryLinksModal; // Expose to window
        
        // ----------------------------------------------
        // NEW FUNCTIONS FOR VISA CHECK SERVICE END
        // ----------------------------------------------


        function renderModalContent(serviceKey) {
            // Re-render the full modal content based on the selected service
            
            if (serviceKey === 'profile') {
                 // **FIX:** Directly call the initial full profile renderer
                 renderProfileContent('full'); 
                 return; 
            }
            
            const data = serviceData[serviceKey] || [];
            const service = serviceMap[serviceKey];
            let html = ``;
            const color = service ? service.color : 'bg-gray-600'; 


            if (serviceKey === 'driving') {
                // Functional service for demo: Nepo Driving
                
                // Add warning if Firebase is inactive
                const demoWarning = !isFirebaseActive ? `
                    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-3 mb-4 rounded-lg text-sm font-medium">
                        <i class="fas fa-exclamation-triangle mr-2"></i> Real-time features are disabled (DEMO MODE).
                    </div>` : '';
                
                // Show the current user ID for multi-user collaboration visibility
                const userIdDisplay = isAuthReady ? `<p class="text-xs text-gray-500 mb-2">Your User ID: <span class="font-mono text-indigo-600">${userId}</span></p>` : '';

                // --- MODIFIED HTML START: Added History Button and Collapsible History Section ---
                html = `<div class="p-4">
                    ${demoWarning}
                    ${userIdDisplay}
                    
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Request a Ride (Ride-hailing)</h3>
                        <!-- NEW HISTORY BUTTON -->
                        <button onclick="document.getElementById('driving-history').classList.toggle('hidden')" 
                            class="py-1 px-3 bg-gray-100 text-sm font-semibold text-indigo-600 rounded-full border border-gray-300 hover:bg-gray-200 transition">
                            <i class="fas fa-history mr-1"></i> History
                        </button>
                    </div>
                    
                    <!-- NEW COLLAPSIBLE HISTORY SECTION -->
                    <div id="driving-history" class="p-4 mb-6 bg-gray-50 rounded-xl border border-gray-200 hidden">
                         <h4 class="text-lg font-bold text-gray-800 mb-3 border-b pb-1">Past 10 Rides</h4>
                         <div class="space-y-3 max-h-56 scrollable-content overflow-y-auto">
                            ${nepoDrivingPastExamples.map(ride => `
                                <div class="p-2 bg-white border border-gray-100 rounded-lg flex justify-between items-center shadow-sm">
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${ride.pickup} <i class="fas fa-arrow-right mx-1 text-xs text-gray-400"></i> ${ride.dropoff}</p>
                                        <p class="text-xs text-gray-500">${ride.type}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-sm font-bold text-green-600">NPR ${ride.cost.toLocaleString()}</span>
                                        <p class="text-xs text-gray-400">${ride.status}</p>
                                    </div>
                                </div>
                            `).join('')}
                            <div class="text-center p-2 text-gray-400 text-xs">-- End of history --</div>
                         </div>
                    </div>
                    <!-- END NEW COLLAPSIBLE HISTORY SECTION -->


                    <form id="driving-form" class="space-y-4 mb-8">
                        <input type="text" id="driving-pickup" placeholder="Pickup Location (GPS)" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <input type="text" id="driving-dropoff" placeholder="Destination" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <select id="driving-car-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="Standard">Standard Car</option>
                            <option value="Carpool">Carpool (Save money)</option>
                            <option value="Premium">Premium SUV</option>
                        </select>
                        <button type="submit" class="w-full py-3 ${color} text-white font-bold rounded-lg hover:opacity-90 transition duration-150">Find Driver</button>
                    </form>

                    <h3 class="text-xl font-semibold mb-3 text-gray-800">Active Ride Requests (${data.length})</h3>
                    <div class="space-y-3 mb-6">
                        ${data.length === 0
                            ? '<p class="text-gray-500 text-sm">No active ride requests found. Request one above!</p>'
                            : data.map(ride => {
                                const isMine = ride.createdBy === userId;
                                return `
                                <div class="p-3 bg-white border border-gray-200 rounded-lg shadow-sm flex justify-between items-center ${isMine ? 'border-indigo-500 bg-indigo-50' : ''}">
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${ride.pickupLocation} <i class="fas fa-arrow-right mx-1 text-xs"></i> ${ride.dropoffLocation}</p>
                                        <p class="text-xs text-gray-500">${ride.carType} - Requested by ${isMine ? 'You' : ride.createdBy.substring(0, 8) + '...'}</p>
                                    </div>
                                    <span class="text-sm font-bold text-indigo-600">Searching...</span>
                                </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>`;
                // --- MODIFIED HTML END ---
            } else if (serviceKey === 'care') {
                const defaultDiseaseKey = diseaseKeys[0]; 

                html = `
                    <div class="p-4 pt-2 sticky top-0 bg-white z-10 border-b border-gray-200">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800">${service.name}</h3>
                        
                        <div class="flex justify-around space-x-2">
                            <button id="tab-awareness" onclick="switchCareTab('awareness')" 
                                class="w-full px-4 py-2 text-sm font-semibold rounded-lg transition shadow-md ${currentCareTab === 'awareness' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}">
                                <i class="fas fa-notes-medical mr-1"></i> Disease Awareness
                            </button>
                            <button id="tab-pharmacy" onclick="switchCareTab('pharmacy')" 
                                class="w-full px-4 py-2 text-sm font-semibold rounded-lg transition shadow-md ${currentCareTab === 'pharmacy' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}">
                                <i class="fas fa-pills mr-1"></i> Nepo Pharmacy
                            </button>
                        </div>
                    </div>

                    <div class="max-h-[70vh] pb-4">
                        <div id="care-content-awareness" class="flex h-[68vh] max-h-[68vh] ${currentCareTab !== 'awareness' ? 'hidden' : ''}">
                            <div class="w-2/5 border-r border-gray-200 overflow-y-auto scrollable-content p-2">
                                <p class="text-xs text-gray-500 font-medium p-2 sticky top-0 bg-white z-20 shadow-sm">
                                    <span>Select Disease (${diseaseKeys.length})</span>
                                    <div class="flex justify-between items-center mt-2">
                                        <button id="lang-en" onclick="switchLanguage('en')" 
                                            class="flex-1 py-1 text-xs font-semibold rounded-l-md transition ${currentLang === 'en' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}">ENG</button>
                                        <button id="lang-ne" onclick="switchLanguage('ne')" 
                                            class="flex-1 py-1 text-xs font-semibold rounded-r-md transition ${currentLang === 'ne' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}">नेप</button>
                                    </div>
                                </p>
                                <div id="disease-list-buttons" class="space-y-1 mt-2">
                                    ${diseaseKeys.map(key => {
                                        const d = nepoDiseaseData[key];
                                        // Default active state for the first button
                                        const isActive = key === defaultDiseaseKey ? 'bg-indigo-200 font-bold' : 'bg-white font-normal';
                                        return `
                                            <button onclick="showDiseaseDetails('${key}')" class="w-full text-left p-2 rounded-lg text-sm transition hover:bg-indigo-50 active:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 ${isActive}" data-disease-key="${key}">
                                                <i class="fas ${d.icon} w-4 mr-2 ${d.color}"></i>
                                                <span class="disease-name-en ${currentLang !== 'en' ? 'hidden' : ''}">${d.name_en}</span>
                                                <span class="disease-name-ne ${currentLang !== 'ne' ? 'hidden' : ''}">${d.name_ne}</span>
                                            </button>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <div class="w-3/5 overflow-y-auto scrollable-content p-4">
                                <div id="disease-details-display">
                                    </div>

                                <div class="mt-8 p-3 bg-red-100 border-l-4 border-red-500 text-red-800 rounded-lg text-sm font-medium">
                                    <i class="fas fa-hospital-user mr-2"></i>
                                    <span class="footer-en ${currentLang !== 'en' ? 'hidden' : ''}">If you experience symptoms, please visit your nearest health center immediately.</span>
                                    <span class="footer-ne ${currentLang !== 'ne' ? 'hidden' : ''}">यदि तपाईलाई कुनै लक्षण देखिएमा, कृपया तुरुन्तै आफ्नो नजिकको स्वास्थ्य केन्द्रमा जानुहोस्।</span>
                                </div>
                                
                                <div class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                    <h4 class="text-md font-semibold text-gray-800 mb-2">Health & Home-Care Services (Examples)</h4>
                                    <div class="space-y-2">
                                        ${nepoCareExamples_full.map(item => `
                                            <div class="flex items-center justify-between text-xs text-gray-700">
                                                <div class="flex items-center">
                                                    <i class="fas ${item.icon} text-sm text-teal-600 mr-2"></i>
                                                    <span>${item.service.split(' (')[0]}</span>
                                                </div>
                                                <span class="font-medium">NPR ${item.cost.toLocaleString()}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="care-content-pharmacy" class="p-4 ${currentCareTab !== 'pharmacy' ? 'hidden' : ''}">
                            <p class="text-sm text-gray-500 mb-3">Search real-time stock and prices across 10 partner pharmacies.</p>
                            
                            <div class="mb-4 sticky top-0 bg-white pt-1 pb-2 z-20 shadow-sm">
                                <div class="relative">
                                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    <input type="text" id="medicine-search" onkeyup="filterMedicines()" placeholder="Search medicine name or category (e.g., Paracetamol, Antibiotic)" 
                                        class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                                </div>
                            </div>
                            
                            <div id="pharmacy-store-list" class="space-y-4 max-h-[50vh] scrollable-content overflow-y-auto">
                                </div>

                            <div class="text-center p-4 text-gray-400 text-sm mt-4">-- Prices are indicative, final cost may vary --</div>
                        </div>
                    </div>
                `;
                modalContentEl.innerHTML = html;
                
                // Initialize the display based on the current active tab
                setTimeout(() => {
                    // Initialize display language and show the default disease
                    if (currentCareTab === 'awareness') {
                        showDiseaseDetails(defaultDiseaseKey, currentLang); 
                        switchLanguage(currentLang); 
                    } else if (currentCareTab === 'pharmacy') {
                         filterMedicines(); // Populate the initial pharmacy list
                         switchCareTab('pharmacy'); 
                    }
                }, 50); 
            } else if (serviceKey === 'news') {
                 // Nepo News 
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Personalized News Feed (${nepoNewsExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Clicking a headline will redirect to the original source portal.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoNewsExamples_full.map(news => `
                            <a href="${news.url}" target="_blank" class="block">
                                <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition duration-150 cursor-pointer">
                                    <div class="flex items-center mb-1">
                                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full text-white ${news.color}">${news.category}</span>
                                    </div>
                                    <p class="font-medium text-base text-gray-800 leading-snug">${news.title}</p>
                                    <div class="flex justify-between items-center text-xs mt-1 text-gray-500">
                                        <span>${news.source}</span>
                                        <span><i class="fas fa-clock mr-1"></i>${news.time}</span>
                                    </div>
                                </div>
                            </a>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of news feed examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'calendar') {
                // Nepo Calendar
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Upcoming Events (Bikram Sambat: ${nepoCalendarExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Nepali dates, festivals, and personal reminders.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoCalendarExamples_full.map(item => `
                            <div class="flex items-start p-3 bg-white border border-gray-200 rounded-xl shadow-sm">
                                <div class="flex-shrink-0 w-10 h-10 ${item.color} rounded-full flex items-center justify-center text-white mr-3">
                                    <i class="fas ${item.icon} text-lg"></i>
                                </div>
                                <div class="flex-grow">
                                    <p class="font-semibold text-sm text-gray-800">${item.name}</p>
                                    <p class="text-xs text-gray-600">${item.date}</p>
                                    <span class="text-xs text-gray-400">${item.type}</span>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of calendar examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'secondhand') {
                // Nepo Second-Hand Market
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Featured Second-Hand Listings (${nepoSecondHandExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Buy and sell verified used goods locally.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoSecondHandExamples_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm flex justify-between items-center">
                                <div class="flex items-center">
                                    <i class="fas ${item.icon} text-xl text-green-600 mr-3"></i>
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${item.item}</p>
                                        <p class="text-xs text-gray-500">Condition: ${item.condition} | ${item.location}</p>
                                    </div>
                                </div>
                                <span class="text-base font-bold text-gray-700">NPR ${item.price.toLocaleString()}</span>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of market examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'shopping') {
                // Nepo Online Shopping
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Your Recent Shopping Orders (${nepoShoppingExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Tracking digital marketplace purchases.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoShoppingExamples_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm flex items-center justify-between">
                                <div class="flex items-center">
                                     <i class="fas ${item.icon} text-xl text-purple-600 mr-3"></i>
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${item.item}</p>
                                        <p class="text-xs text-gray-500">From: ${item.vendor}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold text-gray-700">NPR ${item.price.toLocaleString()}</span>
                                    <p class="text-xs font-semibold ${item.status === 'Delivered' ? 'text-green-500' : item.status === 'Shipped' ? 'text-blue-500' : 'text-orange-500'}">${item.status}</p>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of shopping examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'visa') {
                // Nepo Visa Check
                // **UPDATED: Call the dedicated render function**
                renderVisaCheckList(); 
                return; // Exit to prevent the default HTML from rendering
            } else if (serviceKey === 'donation') {
                // Nepo Donation
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Your Donation History (${nepoDonationExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Secure platform to donate and track organizations.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoDonationExamples_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas ${item.icon} text-xl text-pink-600 mr-3"></i>
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${item.cause}</p>
                                        <p class="text-xs text-gray-500">${item.recipient} | ${item.date}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold text-gray-700">NPR ${item.amount.toLocaleString()}</span>
                                    <p class="text-xs text-gray-400">${item.type}</p>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of donation examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'roomrent') {
                // Nepo Room Rent
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Featured Rental Listings (${nepoRoomRentExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Search or list rooms, flats, and houses.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoRoomRentExamples_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="font-semibold text-sm text-gray-800">${item.title}</p>
                                    <span class="text-sm font-bold text-yellow-600">NPR ${item.rent.toLocaleString()}</span>
                                </div>
                                <div class="text-xs text-gray-500 flex justify-between">
                                    <span><i class="fas ${item.icon} mr-1"></i>${item.type} | ${item.location}</span>
                                    <span>Deposit: ${item.deposit} month${item.deposit > 1 ? 's' : ''}</span>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of rental examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'jobs') {
                // Nepo Part-Time Job
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Local Part-Time Opportunities (${nepoJobsExamples_full.length})</h3>
                    <p class="text-sm text-gray-500 mb-4">Job board for students and freelance workers.</p>
                    <div class="space-y-3 max-h-[70vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoJobsExamples_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm">
                                <div class="flex justify-between items-center mb-1">
                                    <p class="font-semibold text-sm text-gray-800">${item.title}</p>
                                    <span class="text-sm font-bold text-gray-700">${item.pay}</span>
                                </div>
                                <div class="text-xs text-gray-500 flex justify-between">
                                    <span><i class="fas fa-building mr-1"></i>${item.company} | ${item.location}</span>
                                    <span class="text-gray-400">${item.type}</span>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of job examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'wallet') {
                // My Wallet
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">My Nepo Wallet</h3>
                    
                    <div class="header-gradient p-6 rounded-xl shadow-lg mb-6 text-white">
                        <p class="text-sm opacity-80">Wallet Balance</p>
                        <p class="text-4xl font-bold mb-1">NPR 45,678.00</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <button class="flex flex-col items-center justify-center p-3 bg-indigo-100 text-indigo-700 rounded-xl shadow-md hover:bg-indigo-200 transition">
                            <i class="fas fa-money-bill-transfer text-2xl mb-1"></i>
                            <span class="text-sm font-semibold">Top Up</span>
                        </button>
                        <button class="flex flex-col items-center justify-center p-3 bg-green-100 text-green-700 rounded-xl shadow-md hover:bg-green-200 transition">
                            <i class="fas fa-paper-plane text-2xl mb-1"></i>
                            <span class="text-sm font-semibold">Send Money</span>
                        </button>
                    </div>

                    <h3 class="text-lg font-semibold mb-3 text-gray-800">Recent Wallet Activity</h3>
                    <div class="space-y-3 max-h-[40vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoWalletTransactions_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas ${item.icon} text-xl ${item.color} mr-3 w-5 text-center"></i>
                                    <div>
                                        <p class="font-medium text-sm text-gray-800">${item.type}</p>
                                        <p class="text-xs text-gray-500">${item.source} | ${item.date}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold ${item.amount > 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${item.amount > 0 ? '+' : ''}NPR ${Math.abs(item.amount).toLocaleString()}
                                    </span>
                                    <p class="text-xs text-gray-400">${item.category}</p>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of wallet examples --</div>
                    </div>
                </div>`;
            } else if (serviceKey === 'explore') {
                // Explore Destinations
                html = `<div class="p-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Explore: Local Destinations</h3>
                    <p class="text-sm text-gray-500 mb-4">Discover popular local events, sites, and activities near you.</p>

                    <h3 class="text-lg font-semibold mb-3 text-gray-800">Featured Spots (Examples)</h3>
                    <div class="space-y-3 max-h-[60vh] scrollable-content overflow-y-auto pb-4">
                        ${nepoExploreExamples_full.map(item => `
                            <div class="p-3 bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition duration-150 cursor-pointer">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center">
                                        <i class="fas ${item.icon} text-xl ${item.color} mr-3 w-5 text-center"></i>
                                        <div>
                                            <p class="font-medium text-sm text-gray-800">${item.name}</p>
                                            <p class="text-xs text-gray-500">${item.type} | ${item.distance} away</p>
                                        </div>
                                    </div>
                                    <div class="text-right flex items-center">
                                        <span class="text-sm font-bold text-amber-500"><i class="fas fa-star mr-1 text-xs"></i>${item.rating}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        <div class="text-center p-4 text-gray-400 text-sm">-- End of explore examples --</div>
                    </div>
                </div>`;
            } else {
                // Generic content for the other services
                html = `<div class="p-4">
                    <p class="text-center text-gray-500 pt-8 text-lg font-medium">
                        Welcome to the <span class="text-gray-800 font-bold">${service.name}</span> service!
                    </p>
                    <div class="text-center p-8">
                        <i class="fas ${service.icon} text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-400 mt-2">This feature is coming soon and will include its core functions: ${service.name} is about ${service.name === 'Nepo News' ? 'real-time local updates and personalized feeds.' : service.name === 'Nepo Calendar' ? 'Bikram Sambat dates, festivals, and event reminders.' : service.name === 'Nepo Care' ? 'online health bookings and remote consultations.' : service.name === 'Nepo Second-Hand Market' ? 'verified listings to buy and sell used goods safely.' : service.name === 'Nepo Online Shopping' ? 'a digital marketplace with fast local delivery.' : service.name === 'Nepo Visa Check' ? 'API-based visa and immigration status verification.' : service.name === 'Nepo Donation' ? 'a secure platform to donate to local charities and causes.' : service.name === 'Nepo Room Rent' ? 'an online service connecting landlords and tenants and housing.' : 'a local job board for part-time and freelance opportunities.'}</p>
                    </div>
                </div>`;
            }

            modalContentEl.innerHTML = html;
            attachFormListeners(serviceKey);
        }
        
        // --- End of renderModalContent ---

        // Attach listeners to newly rendered forms
        function attachFormListeners(serviceKey) {
            const form = document.getElementById(`${serviceKey}-form`);
            if (form) {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!isAuthReady) return displayMessage("App is still initializing authentication. Please wait.", 'warning');

                    let itemData = {};

                    if (serviceKey === 'driving') {
                        itemData = {
                            pickupLocation: document.getElementById('driving-pickup').value,
                            dropoffLocation: document.getElementById('driving-dropoff').value,
                            carType: document.getElementById('driving-car-type').value,
                            status: 'requested'
                        };
                    } else {
                        // This block should theoretically not be hit since we only attach the listener for 'driving'
                        displayMessage(`The ${serviceMap[serviceKey].name} feature is still under development!`, 'info');
                        form.reset();
                        return;
                    }

                    const success = await addItem(serviceKey, itemData);
                    if (success) {
                        form.reset();
                        displayMessage(`${serviceMap[serviceKey].name} request successful! Looking for a match!`, 'success');
                    }
                });
            }
        }


        function displayMessage(text, type = 'info') {
            const messageEl = document.getElementById('message-box');
            messageEl.textContent = text;
            messageEl.className = 'fixed top-4 right-4 p-3 rounded-xl shadow-xl z-50 transition duration-300';

            if (type === 'success') {
                messageEl.classList.add('bg-green-500', 'text-white');
            } else if (type === 'error') {
                messageEl.classList.add('bg-red-500', 'text-white');
            } else if (type === 'warning') {
                messageEl.classList.add('bg-yellow-500', 'text-gray-900');
            } else {
                messageEl.classList.add('bg-blue-500', 'text-white');
            }

            messageEl.classList.remove('opacity-0');

            // Hide the message after 3 seconds
            setTimeout(() => {
                messageEl.classList.add('opacity-0');
            }, 3000);
            
            // Re-enable pointer events after transition
            setTimeout(() => {
                messageEl.classList.remove('pointer-events-auto');
                messageEl.classList.add('pointer-events-none');
            }, 3300);
            messageEl.classList.remove('pointer-events-none');
            messageEl.classList.add('pointer-events-auto');
        }


        // Function to initialize the main service grid
        function loadServiceData() {
            const gridEl = document.getElementById('service-grid');
            if (!gridEl) return;

            const serviceKeys = Object.keys(serviceMap);
            gridEl.innerHTML = serviceKeys.map(key => {
                const service = serviceMap[key];
                return `
                    <div class="service-card ${service.color} p-6 rounded-xl shadow-lg flex flex-col items-center text-white text-center" data-service-key="${key}">
                        <i class="fas ${service.icon} text-4xl mb-3"></i>
                        <span class="font-semibold text-lg">${service.name.replace('Nepo ', '')}</span>
                        <span class="text-xs opacity-80 mt-1">${service.name}</span>
                    </div>
                `;
            }).join('');

            // Attach click listeners to the service cards
            gridEl.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const key = e.currentTarget.getAttribute('data-service-key');
                    if (key) {
                        openModal(key);
                    }
                });
            });
        }

        // Initialize on window load
        window.onload = () => {
            initializeFirebase();
            displayForecast();
            openGreeting();
        };
        window.openModal = openModal; 
        window.closeModal = closeModal;
    </script>

    <div class="max-w-md mx-auto h-screen flex flex-col bg-white shadow-xl">

        <header class="header-gradient p-6 rounded-b-3xl shadow-lg">
            <div class="flex justify-between items-center text-white mb-4">
                <h1 class="text-2xl font-extrabold tracking-tight">Nepo App</h1>
                <div class="flex space-x-3 items-center">
                    <button onclick="openAppInfoModal()" class="text-white text-2xl opacity-90 hover:opacity-100 transition">
                        <i class="fas fa-circle-info"></i>
                    </button>
                </div>
            </div>

            <div id="weather-forecast" class="flex items-center text-white p-2 bg-white bg-opacity-20 rounded-lg">
                <i class="fas fa-cloud text-lg mr-2 text-gray-200"></i>
                <span class="text-sm font-medium">Loading today's forecast...</span>
            </div>
        </header>

        <main id="main-content" class="flex-grow p-4 scrollable-content overflow-y-auto">

            <div class="construction-effect border-l-8 p-4 mb-6 rounded-xl shadow-md" role="alert">
                <div class="flex items-center">
                    <i class="fas fa-tools mr-3 text-lg"></i>
                    <p class="font-semibold text-sm">App is under construction.</p>
                </div>
            </div>

            <section class="mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-3">Quick Access</h2>
                <div id="quick-access-grid" class="grid grid-cols-3 gap-3">
                    <div onclick="openModal('news')" class="bg-red-100 text-red-800 p-3 rounded-xl text-center transition hover:bg-red-200 cursor-pointer shadow-md">
                        <i class="fas fa-newspaper text-xl mb-1"></i>
                        <p class="text-xs font-medium">News</p>
                    </div>
                    <!-- MODIFIED: Replaced 'calendar' with 'visa' check -->
                    <div onclick="openModal('visa')" class="bg-blue-100 text-blue-800 p-3 rounded-xl text-center transition hover:bg-blue-200 cursor-pointer shadow-md">
                        <i class="fas fa-passport text-xl mb-1"></i>
                        <p class="text-xs font-medium">Visa Check</p>
                    </div>
                    <div onclick="openModal('driving')" class="bg-indigo-100 text-indigo-800 p-3 rounded-xl text-center transition hover:bg-indigo-200 cursor-pointer shadow-md">
                        <i class="fas fa-car-side text-xl mb-1"></i>
                        <p class="text-xs font-medium">Driving</p>
                    </div>
                </div>
            </section>

            <section class="mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-3">All 10 Main Features</h2>
                <div id="service-grid" class="grid grid-cols-2 gap-4">
                    <div class="text-center p-8 text-gray-400">Loading features...</div>
                </div>
            </section>
        </main>

        <nav class="bg-white border-t border-gray-200 p-2 shadow-2xl">
            <div class="flex justify-around items-center">
                <a href="#" class="flex flex-col items-center text-indigo-600">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs mt-1">Home</span>
                </a>
                <a onclick="openModal('wallet')" class="flex flex-col items-center text-gray-400 hover:text-gray-600 cursor-pointer">
                    <i class="fas fa-wallet text-xl"></i>
                    <span class="text-xs mt-1">Wallet</span>
                </a>
                <a onclick="openModal('explore')" class="flex flex-col items-center text-gray-400 hover:text-gray-600 cursor-pointer">
                    <i class="fas fa-map-marked-alt text-xl"></i>
                    <span class="text-xs mt-1">Explore</span>
                </a>
                <a onclick="openModal('profile')" class="flex flex-col items-center text-gray-400 hover:text-gray-600 cursor-pointer">
                    <i class="fas fa-user-circle text-xl"></i>
                    <span class="text-xs mt-1">Profile</span>
                </a>
            </div>
        </nav>

    </div>

    <div id="service-modal" class="modal hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-50 flex items-end justify-center">
        <div class="modal-content w-full max-w-md bg-white rounded-t-3xl shadow-2xl max-h-[85vh] flex flex-col transform translate-y-0" role="dialog" aria-modal="true">
            <div class="sticky top-0 bg-white p-4 border-b border-gray-200 rounded-t-3xl flex justify-between items-center z-20">
                <h2 id="modal-title" class="text-xl font-bold text-gray-900">Service Name</h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 p-1">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="modal-content" class="flex-grow">
                <div class="p-8 text-center text-gray-400">Loading content...</div>
            </div>
        </div>
    </div>
    
    <div id="greeting-modal" class="hidden fixed inset-0 z-50 bg-gray-900 bg-opacity-70 flex items-center justify-center transition duration-300" role="dialog" aria-modal="true">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center transform scale-100 transition duration-300 max-w-xs mx-4">
            <p class="text-6xl mb-4">नमस्ते🙏</p>
            <p class="text-lg font-semibold text-gray-800">Welcome to Nepo Super App!</p>
            <p class="text-sm text-gray-500 mt-1">Tap below to start exploring the digital world of Nepal🇳🇵</p>
            <button onclick="document.getElementById('greeting-modal').classList.add('hidden')" class="mt-4 w-full py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                Enter App
            </button>
        </div>
    </div>

    <div id="app-info-modal" class="hidden fixed inset-0 z-50 bg-gray-900 bg-opacity-70 flex items-center justify-center transition duration-300" role="dialog" aria-modal="true">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center transform scale-100 transition duration-300 max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <p class="text-4xl mb-4 text-indigo-600"><i class="fas fa-satellite-dish"></i></p>
            <p class="text-xl font-extrabold text-gray-900">🇳🇵 Nepo Super App</p>
            <p class="text-sm text-gray-500 mt-1 mb-4">Version 1.0.2 - Demo Prototype | <span class="font-semibold text-indigo-700">Goal: Full Release by Late 2028</span></p>

            <div class="text-left mb-6 p-4 bg-indigo-50 rounded-xl border border-indigo-200">
                <h3 class="font-bold text-base text-indigo-700 mb-2">Project Vision: Unified Digital Ecosystem</h3>
                <p class="text-sm text-gray-700">The Nepo Super App is envisioned as a unified, multi-service digital ecosystem aiming to streamline daily life for the Nepali public. By consolidating 11 essential services—from mobility and finance to health and community resources—into a single interface, it maximizes convenience and efficiency.</p>
            </div>

            <h3 class="font-bold text-base text-gray-800 mb-2 text-left">11 Core Services & Pillars</h3>
            <div class="space-y-1.5 mb-6 text-sm text-left max-h-48 overflow-y-auto p-3 bg-gray-50 rounded-xl shadow-inner border border-gray-200">
                <p class="font-semibold text-indigo-600">I. Mobility & Logistics:</p>
                <p class="ml-3"><i class="fas fa-car-side mr-1"></i> **Nepo Driving** (Ride-Hailing) | <i class="fas fa-map-marked-alt mr-1"></i> **Explore Local** (Destination Discovery)</p>
                <hr class="my-1 border-gray-200">
                <p class="font-semibold text-teal-600">II. Health & Wellness:</p>
                <p class="ml-3"><i class="fas fa-hand-holding-medical mr-1"></i> **Nepo Care** (Health & Appoint. Tracking) | <i class="fas fa-hand-holding-heart mr-1"></i> **Nepo Donation** (Charitable Contributions)</p>
                <hr class="my-1 border-gray-200">
                <p class="font-semibold text-amber-600">III. Finance & Commerce:</p>
                <p class="ml-3"><i class="fas fa-wallet mr-1"></i> **My Wallet** (Digital Finance Hub) | <i class="fas fa-bag-shopping mr-1"></i> **Online Shopping** (Order Tracking)</p>
                <p class="ml-3"><i class="fas fa-tags mr-1"></i> **Second-Hand Market** (Community Listings)</p>
                <hr class="my-1 border-gray-200">
                <p class="font-semibold text-purple-600">V. Information & Utility:</p>
                <p class="ml-3"><i class="fas fa-newspaper mr-1"></i> **Nepo News** (Media Aggregation) | <i class="fas fa-calendar-days mr-1"></i> **Nepo Calendar** (Bikram Sambat Ref.)</p>
                <p class="ml-3"><i class="fas fa-briefcase mr-1"></i> **Part-Time Job** (Local Job Board) | <i class="fas fa-passport mr-1"></i> **Visa Check** (Status Verification)</p>
            </div>

            <h3 class="font-bold text-base text-gray-800 mb-2 text-left">3-Year Roadmap Rationale</h3>
            <div class="space-y-2 mb-6 text-sm text-left p-3 bg-red-50 rounded-xl border border-red-200">
                <p class="text-gray-700"><i class="fas fa-shield-alt mr-1 text-red-600"></i> **Security & Scalability:** Building robust infrastructure for mass adoption and financial regulatory compliance.</p>
                <p class="text-gray-700"><i class="fas fa-rocket mr-1 text-red-600"></i> **Feature Rollout:** Prioritizing critical services (Driving, Wallet, Care) first, followed by utility features.</p>
            </div>

            <!-- DYNAMIC FOUNDER CONTACT SECTION - Content is injected by renderAppInfoContent() -->
            <div id="founder-contact-container" class="text-sm font-semibold text-gray-700 mt-4 border-t pt-4">
                <!-- Placeholder content before JS injection -->
                <p class="text-xs text-gray-500 mb-1">Loading founder contact...</p>
            </div>
            
            <button onclick="document.getElementById('app-info-modal').classList.add('hidden')" class="mt-6 w-full py-3 bg-gray-200 text-gray-800 font-bold rounded-lg hover:bg-gray-300 transition duration-150 shadow-md">
                Close Info
            </button>
        </div>
    </div>
    
    <!-- This box is used for temporary status messages like "Success" or "Error" -->
    <div id="message-box" class="fixed top-4 right-4 p-3 rounded-xl shadow-xl z-50 opacity-0 transition duration-300 pointer-events-none"></div>

</body>
</html>
